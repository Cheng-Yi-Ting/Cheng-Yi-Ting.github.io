<!DOCTYPE html>
<html>

<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-151412407-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-151412407-1');
    </script>

    <meta charset="utf-8">
    
        <title>
            
                第 2 頁 |
                    
                        Cyting 部落格
        </title>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        
                        
                                
                                        
                                                <meta name="description" content="部落格主要記載程式技術、科技或生活類型文章">
<meta property="og:type" content="website">
<meta property="og:title" content="Cyting 部落格">
<meta property="og:url" content="https://cheng-yi-ting.github.io/page/2/index.html">
<meta property="og:site_name" content="Cyting 部落格">
<meta property="og:description" content="部落格主要記載程式技術、科技或生活類型文章">
<meta property="og:locale" content="zh_TW">
<meta property="article:author" content="Cheng-Yi-Ting">
<meta property="article:tag" content="Coding ">
<meta property="article:tag" content="程式">
<meta property="article:tag" content="前端">
<meta name="twitter:card" content="summary">
                                                    
                                                        <link rel="alternate" href="/atom.xml" title="Cyting 部落格" type="application/atom+xml">
                                                        
                                                            <link rel="icon" href="/css/images/favicon.ico">
                                                            
                                                                <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
                                                                
                                                                    <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
                                                                    <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
                                                                    <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
                                                                    <style type="text/css">
                                                                        @font-face {
                                                                            font-family: futura-pt;
                                                                            src: url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");
                                                                            font-weight: 500;
                                                                            font-style: normal;
                                                                        }
                                                                        
                                                                        @font-face {
                                                                            font-family: futura-pt;
                                                                            src: url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");
                                                                            font-weight: 500;
                                                                            font-style: normal;
                                                                        }
                                                                        
                                                                        @font-face {
                                                                            font-family: futura-pt;
                                                                            src: url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");
                                                                            font-weight: lighter;
                                                                            font-style: normal;
                                                                        }
                                                                        
                                                                        @font-face {
                                                                            font-family: futura-pt;
                                                                            src: url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");
                                                                            font-weight: 400;
                                                                            font-style: italic;
                                                                        }
                                                                    </style>

                                                                    <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

                                                                    <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
                                                                    
<link rel="stylesheet" href="../../css/style.css">


                                                                        
<script src="../../js/jquery-3.1.1.min.js"></script>


                                                                            <!-- Bootstrap core CSS -->
                                                                            <link rel="stylesheet" href="/css/bootstrap.css">
                                                                            <link rel="stylesheet" href="/css/fashion.css">
                                                                            <link rel="stylesheet" href="/css/glyphs.css">

<meta name="generator" content="Hexo 4.2.0"></head>


  <body>


  


<header id="allheader" class="site-header" role="banner" 
   >
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="Cyting 部落格" rel="home"> Cyting 部落格 </a>
            
          </h1>
          
          
            <div class="site-description">部落格主要記載程式技術、科技或生活類型文章</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="../../index.html">首頁</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="../../archives">歸檔</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="../../categories">分類</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="../../tags">標籤</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main">
  
    <article id="post-2019-12-13-JavaScript-20"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="../../2019/12/14/2019-12-13-JavaScript-20/">JavaScript ES6 Class</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="../../2019/12/14/2019-12-13-JavaScript-20/" class="article-date">
	  <time datetime="2019-12-13T16:00:00.000Z" itemprop="datePublished">十二月 14, 2019</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="logo.svg" style="width:15%;">

<br/>

<p><br/><br/></p>
<p>JavaScript是一個以原型為基礎(prototype-based)的物件導向程式語言，而 ES6 Class 只是個語法糖(syntactical sugar)，目的是提供更簡潔的語法來作物件建立與繼承。</p>
<p>我們過去使用 function constructor 來產生類別物件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Employee</span>(<span class="params">name, age,salary</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 定義基本屬性</span></span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="keyword">this</span>.salary = salary;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 原型方法</span></span><br><span class="line">Employee.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Employee.prototype.employeeDetails = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="string">'Name: '</span>+<span class="keyword">this</span>.name+<span class="string">', Age:'</span>+<span class="keyword">this</span>.age+<span class="string">', salary:'</span>+<span class="keyword">this</span>.salary;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> felix = <span class="keyword">new</span> Employee(<span class="string">'Felix'</span>, <span class="number">18</span>, <span class="number">22000</span>);</span><br><span class="line"><span class="comment">//Name: Felix, Age:18, salary:22000</span></span><br><span class="line"><span class="built_in">console</span>.log(felix.employeeDetails());</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hector= <span class="keyword">new</span> Employee(<span class="string">'Hector'</span>, <span class="number">25</span>, <span class="number">36000</span>);</span><br><span class="line"><span class="comment">//Name: Hector, Age:25, salary:36000</span></span><br><span class="line"><span class="built_in">console</span>.log(hector.employeeDetails());</span><br></pre></td></tr></table></figure>

<h1 id="ES6-Constructor"><a href="#ES6-Constructor" class="headerlink" title="ES6 Constructor"></a>ES6 Constructor</h1><h3 id="類別宣告（Class-Declaration）"><a href="#類別宣告（Class-Declaration）" class="headerlink" title="類別宣告（Class Declaration）"></a>類別宣告（Class Declaration）</h3><p>一個定義類別的方法是使用類別宣告(class declaration)，使用關鍵字 class 搭配類別名稱(此例為 “Employee”)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span>(name, age, salary) &#123;</span><br><span class="line">     <span class="keyword">this</span>.name= name;</span><br><span class="line">     <span class="keyword">this</span>.age = age;</span><br><span class="line">     <span class="keyword">this</span>.salary= salary;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="類別敘述（Class-Expression）"><a href="#類別敘述（Class-Expression）" class="headerlink" title="類別敘述（Class Expression）"></a>類別敘述（Class Expression）</h3><p>類別敘述是定義類別的另一種方法，可區分為有名稱或無名稱的類別敘述。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// named class expression</span></span><br><span class="line"><span class="keyword">var</span> Employee = <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span>(name, age, salary) &#123;</span><br><span class="line">     <span class="keyword">this</span>.name= name;</span><br><span class="line">     <span class="keyword">this</span>.age = age;</span><br><span class="line">     <span class="keyword">this</span>.salary= salary;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// unnamed class expression</span></span><br><span class="line"><span class="keyword">var</span> Employee = <span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span>(name, age, salary) &#123;</span><br><span class="line">     <span class="keyword">this</span>.name= name;</span><br><span class="line">     <span class="keyword">this</span>.age = age;</span><br><span class="line">     <span class="keyword">this</span>.salary= salary;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hector= <span class="keyword">new</span> Employee(<span class="string">'Hector'</span>, <span class="number">25</span>, <span class="number">36000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Hoisting"><a href="#Hoisting" class="headerlink" title="Hoisting"></a>Hoisting</h3><p>函式宣告和類別宣告的一個重要差別在於函式宣告是會 hoisted，而類別宣告則不會。使用類別宣告方法，需要先宣告類別才能進行存取，否則會出現 ReferenceError 的錯誤。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Uncaught ReferenceError: Cannot access 'Employee' before initialization</span></span><br><span class="line"><span class="keyword">var</span> Vincent = <span class="keyword">new</span> Employee(); </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>以下為將第一個例子修改為 Class 方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, age, salary) &#123;</span><br><span class="line">        <span class="comment">// 定義基本屬性</span></span><br><span class="line">        <span class="keyword">this</span>.name= name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.salary= salary;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 原型方法</span></span><br><span class="line">  getName() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">   &#125;</span><br><span class="line">     </span><br><span class="line">  employeeDetails() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Name: '</span>+<span class="keyword">this</span>.name+<span class="string">', Age:'</span>+<span class="keyword">this</span>.age+<span class="string">',                 salary:'</span>+<span class="keyword">this</span>.salary;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Name: Felix, Age:18, salary:22000</span></span><br><span class="line"><span class="keyword">var</span> felix = <span class="keyword">new</span> Employee(<span class="string">'Felix'</span>, <span class="number">18</span>, <span class="number">22000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(felix.employeeDetails());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Name: Hector, Age:25, salary:36000</span></span><br><span class="line"><span class="keyword">var</span> hector= <span class="keyword">new</span> Employee(<span class="string">'Hector'</span>, <span class="number">25</span>, <span class="number">36000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(hector.employeeDetails());</span><br></pre></td></tr></table></figure>

<p>改由 constructor 定義物件內的屬性，並將以前的 prototype 直接寫在 class 內，讓程式碼更為直觀。</p>
<h3 id="靜態方法"><a href="#靜態方法" class="headerlink" title="靜態方法"></a>靜態方法</h3><p>我們可以在 class 內定義靜態方法，靜態方法只能被原型使用，無法在創立的物件上使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, age, salary) &#123;</span><br><span class="line">     <span class="keyword">this</span>.name= name;</span><br><span class="line">     <span class="keyword">this</span>.age = age;</span><br><span class="line">     <span class="keyword">this</span>.salary= salary;</span><br><span class="line"> &#125;</span><br><span class="line">  <span class="keyword">static</span> testMethod()&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="string">'static method has been called.'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hector= <span class="keyword">new</span> Employee(<span class="string">'Hector'</span>, <span class="number">25</span>, <span class="number">36000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//hector.testMethod is not a function</span></span><br><span class="line">hector.testMethod();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 'static method has been called.'</span></span><br><span class="line">Employee.testMethod()</span><br></pre></td></tr></table></figure>

<h3 id="Get-and-Set"><a href="#Get-and-Set" class="headerlink" title="Get and Set"></a>Get and Set</h3><p>get 與 set 關鍵字分別代表取得方法和設定方法，一般的公開的的屬性不需要用到這兩種方法，本來就能直接取值或設定；只有私有屬性才需要用到 get 和 set 方法來作取得或設定。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6 get and set</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name, age) &#123;</span><br><span class="line">     <span class="keyword">this</span>.name= name;</span><br><span class="line">     <span class="keyword">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> salary() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"The code executed on getting obj.salary"</span>);</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">this</span>._salary!== <span class="literal">undefined</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._salary;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'no salary prop'</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> salary(value) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"The code executed on setting obj.salary = value;"</span>)</span><br><span class="line">     <span class="keyword">this</span>._salary=value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hector = <span class="keyword">new</span> Employee(<span class="string">'Hector'</span>,<span class="number">18</span>);</span><br><span class="line"><span class="comment">//The code executed on setting obj.salary = value;</span></span><br><span class="line">hector.salary=<span class="string">'35000'</span>;</span><br><span class="line"><span class="comment">//The code executed on getting obj.salary</span></span><br><span class="line"><span class="comment">//"35000"</span></span><br><span class="line">hector.salary;</span><br></pre></td></tr></table></figure>

<p>getter不會有傳入參數，setter 則只能傳入一個參數。</p>
<h3 id="繼承"><a href="#繼承" class="headerlink" title="繼承"></a>繼承</h3><p>我們之前透過函式建構式來達成類別繼承，為了讓子類別繼承父類別建構函式的內容，所以我們必須在子類別建構函式中呼叫父類別建構函式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person 的 constructor function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.name = name || <span class="string">'default'</span>;</span><br><span class="line"> <span class="keyword">this</span>.age = age || <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">this</span>.skill= [<span class="string">'HTML'</span>,<span class="string">'CSS'</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Student 的 constructor function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.name = name;</span><br><span class="line"> <span class="keyword">this</span>.score = <span class="number">100</span>;</span><br><span class="line"> Person.call(<span class="keyword">this</span>,name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="extends"><a href="#extends" class="headerlink" title="extends"></a>extends</h3><p>ES6 簡化類別宣告的過程，我們不需要再去修改原型物件，也能直接完成繼承的效果。</p>
<p>這裡會使用到兩個關鍵字：</p>
<ul>
<li><code>extends</code>: 繼承於另一個原型之下。</li>
<li><code>super</code> : 使用上層的值(屬性)。</li>
</ul>
<p>創造子類別 Student，並使用 extends 指向 Person，讓 Student 繼承 Person：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span>(name, age) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name || <span class="string">'default'</span>;</span><br><span class="line">    <span class="keyword">this</span>.age = age || <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.skill= [<span class="string">'HTML'</span>,<span class="string">'CSS'</span>];</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> hi() &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">`Hi, <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> ,My age is <span class="subst">$&#123;<span class="keyword">this</span>.age&#125;</span>.`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name);</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.score = <span class="number">100</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> say() &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">`Say, <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> ,My score is <span class="subst">$&#123;<span class="keyword">this</span>.score&#125;</span>.`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> roman = <span class="keyword">new</span> Student(<span class="string">'roman'</span>);</span><br></pre></td></tr></table></figure>

<p>繼承的子類別中的建構式， super() 需要放在建構式第一行，這是標準的呼叫方式。如果有需要傳入參數可以傳入。</p>
<p>繼承的子類別中的屬性與方法，都會覆蓋掉原有的在父母類別中的同名稱屬性或方法，要區分不同的屬性或方法要用 super 關鍵字來存取父母類別中的屬性或方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span>(name, age) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name || <span class="string">'default'</span>;</span><br><span class="line">    <span class="keyword">this</span>.age = age || <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.skill= [<span class="string">'HTML'</span>,<span class="string">'CSS'</span>];</span><br><span class="line"> &#125;</span><br><span class="line"> hi() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Hi, <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> ,My age is <span class="subst">$&#123;<span class="keyword">this</span>.age&#125;</span>.`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line"> <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name);</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.score = <span class="number">100</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> hi() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">super</span>.hi());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> roman = <span class="keyword">new</span> Student(<span class="string">'roman'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hi, roman ,My age is 0.</span></span><br><span class="line">roman.hi();</span><br></pre></td></tr></table></figure>

<h3 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h3><ol>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10185583" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10185583</a></p>
</li>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10195056" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10195056</a></p>
</li>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10226111" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10226111</a></p>
</li>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10196867" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10196867</a></p>
</li>
</ol>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-2019-12-12-JavaScript-19"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="../../2019/12/13/2019-12-12-JavaScript-19/">JavaScript Object-oriented programming</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="../../2019/12/13/2019-12-12-JavaScript-19/" class="article-date">
	  <time datetime="2019-12-12T16:00:00.000Z" itemprop="datePublished">十二月 13, 2019</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="logo.svg" style="width:15%;">

<br/>

<p><br/><br/></p>
<h2 id="Prototype-based-Inheritance-基於原型的繼承"><a href="#Prototype-based-Inheritance-基於原型的繼承" class="headerlink" title="Prototype-based Inheritance (基於原型的繼承)"></a>Prototype-based Inheritance (基於原型的繼承)</h2><p>JavaScript 的繼承是 prototype-based，意思就是在 JavaScript 中沒有 class，<strong>所有的 object 都繼承自其它的 object</strong>。</p>
<p>以下為繼承的實作範例，先建立父層類別 Person 和子層類別 Student：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person 的 constructor function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name || <span class="string">'default'</span>;</span><br><span class="line">    <span class="keyword">this</span>.age = age || <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.skill= [<span class="string">'HTML'</span>,<span class="string">'CSS'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Person 的 prototype</span></span><br><span class="line">Person.prototype.hi= <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Hi, <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> ,My age is <span class="subst">$&#123;<span class="keyword">this</span>.age&#125;</span>.`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Student 的 constructor function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.score = <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Student 繼承 Person</span></span><br><span class="line">Student.prototype = <span class="keyword">new</span> Person()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Student的 prototype 方法</span></span><br><span class="line">Student.prototype.say = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Say, <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> ,My score is <span class="subst">$&#123;<span class="keyword">this</span>.score&#125;</span>.`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立物件實例</span></span><br><span class="line"><span class="keyword">var</span> roman = <span class="keyword">new</span> Student(<span class="string">'roman'</span>);</span><br><span class="line"><span class="keyword">var</span> hera = <span class="keyword">new</span> Student(<span class="string">'hera'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hi, roman ,My age is 0.</span></span><br><span class="line">roman.hi();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Say, roman ,My score is 100.</span></span><br><span class="line">roman.say();</span><br><span class="line"></span><br><span class="line">roman.skill.push(<span class="string">'JavaScript'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(roman.skill)   <span class="comment">// ["HTML","CSS","JavaScript"]</span></span><br><span class="line"><span class="built_in">console</span>.log(hera.skill)    <span class="comment">// ["HTML","CSS","JavaScript"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//物件的繼承關係 (prototype chain) </span></span><br><span class="line"><span class="built_in">console</span>.log(roman.__proto__ === Student.prototype)<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(Student.prototype.__proto__ === Person.prototype)<span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<p>由於 skill 這個屬性是定義在父層元素，而父層元素是會被子層元素所影響；因為  roman 物件中並沒有 skill 屬性，因此會透過原型練存取到 Person 的 skill(<code>roman.__proto__.skill</code>)，造成修改 roman.skill 卻連帶的影響到 hera.skill 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">roman.skill.push(<span class="string">'JavaScript'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(roman.skill) <span class="comment">// ["HTML","CSS","JavaScript"]</span></span><br><span class="line"><span class="built_in">console</span>.log(hera.skill)  <span class="comment">// ["HTML","CSS","JavaScript"]</span></span><br></pre></td></tr></table></figure>

<h3 id="物件實例不會影響到父層屬性"><a href="#物件實例不會影響到父層屬性" class="headerlink" title="物件實例不會影響到父層屬性"></a>物件實例不會影響到父層屬性</h3><p>為了避免子類別實例影響父類別屬性的問題，我們可以使用 Person.call(this) ，把 Person 裡面的 this 指稱對象改成當前透過 Student 建構式所建立的物件實例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.name = name;</span><br><span class="line"> <span class="keyword">this</span>.score = <span class="number">100</span>;</span><br><span class="line"> Person.call(<span class="keyword">this</span>,name);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>等同於把原本 Person 的內容複製到 Student 中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line"> <span class="comment">//父層屬性</span></span><br><span class="line"> <span class="keyword">this</span>.name = name || <span class="string">'default'</span>;</span><br><span class="line"> <span class="keyword">this</span>.age = age || <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">this</span>.skill= [<span class="string">'HTML'</span>,<span class="string">'CSS'</span>];</span><br><span class="line"> <span class="comment">//子層屬性</span></span><br><span class="line"> <span class="keyword">this</span>.score = <span class="number">100</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>這時候物件實例就不會共享到父層的屬性了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 建立物件實例</span></span><br><span class="line"><span class="keyword">var</span> roman = <span class="keyword">new</span> Student(<span class="string">'roman'</span>);</span><br><span class="line"><span class="keyword">var</span> hera = <span class="keyword">new</span> Student(<span class="string">'hera'</span>);</span><br><span class="line"></span><br><span class="line">roman.skill.push(<span class="string">'JavaScript'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(roman.skill) <span class="comment">// ["HTML","CSS","JavaScript"]</span></span><br><span class="line"><span class="built_in">console</span>.log(hera.skill)  <span class="comment">// ["HTML","CSS"]</span></span><br></pre></td></tr></table></figure>

<h3 id="Object-create-and-new-operator-差異"><a href="#Object-create-and-new-operator-差異" class="headerlink" title="Object.create() and new operator 差異"></a>Object.create() and new operator 差異</h3><p>也可以使用此方法來實現繼承：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Student.prototype = <span class="built_in">Object</span>.create(Person.prototype);</span><br></pre></td></tr></table></figure>

<p>為了避免瀏覽器太舊不支援 Object.create() ，可自行 polyfill 來達成一樣的效果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同 Student.prototype = Object.create(Person.prototype)</span></span><br><span class="line">Student.prototype = inherit(Person.prototype);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.create()</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inherit</span>(<span class="params">proto</span>) </span>&#123;</span><br><span class="line"> <span class="comment">//先建立一個空的 F constructor function</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;; </span><br><span class="line"> <span class="comment">//將 F.prototype 指向傳進來的 proto</span></span><br><span class="line"> F.prototype = proto;</span><br><span class="line"> <span class="comment">//用函式建構式的方式回傳</span></span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>兩種方法差異在於 new Person()  會執行建構式中的程式碼，而 object.create() 並不會，以下為第一個範例的修改：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person 的 constructor function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.name = name || <span class="string">'default'</span>;</span><br><span class="line"> <span class="keyword">this</span>.age = age || <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">this</span>.skill= [<span class="string">'HTML'</span>,<span class="string">'CSS'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Person 的 prototype</span></span><br><span class="line">Person.prototype.hi= <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">`Hi, <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> ,My age is <span class="subst">$&#123;<span class="keyword">this</span>.age&#125;</span>.`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Student 的 constructor function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.name = name;</span><br><span class="line"> <span class="keyword">this</span>.score = <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Student 繼承 Person</span></span><br><span class="line">Student.prototype = <span class="built_in">Object</span>.create(Person.prototype)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Student的 prototype 方法</span></span><br><span class="line">Student.prototype.say = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">`Say, <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> ,My score is         <span class="subst">$&#123;<span class="keyword">this</span>.score&#125;</span>.`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立物件實例</span></span><br><span class="line"><span class="keyword">var</span> roman = <span class="keyword">new</span> Student(<span class="string">'roman'</span>);</span><br><span class="line"><span class="keyword">var</span> hera = <span class="keyword">new</span> Student(<span class="string">'hera'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hi, roman ,My age is undefined.</span></span><br><span class="line">roman.hi();</span><br><span class="line"><span class="comment">// Say, roman ,My score is 100.</span></span><br><span class="line">roman.say();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Uncaught TypeError: Cannot read property 'push' of undefined</span></span><br><span class="line">roman.skill.push(<span class="string">'JavaScript'</span>)</span><br></pre></td></tr></table></figure>

<p>因為沒有執行 Person 函式建構式的內容，當呼叫 roman.hi(); 中的  this.age 為 undefined；沒有 skill 屬性所以也無法使用 push 方法。</p>
<p>以下為使用兩種方式建立 roman 物件：</p>
<p><strong><code>Student.prototype = new Person()</code></strong></p>
<img src="2019-12-12-JavaScript-19-1.PNG" style="width:50%;">
<br/>
<br/>

<p><strong><code>Student.prototype = Object.create(Person.prototype)</code></strong></p>
<img src="2019-12-12-JavaScript-19-2.PNG" style="width:50%;">

<h3 id="Polymorphism-多型"><a href="#Polymorphism-多型" class="headerlink" title="Polymorphism (多型)"></a>Polymorphism (多型)</h3><p>透過在子類別中重寫覆蓋 (override) 掉父類別中的方法或屬性來完成多型。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Student.prototype.hi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">`Hi, <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> ,My score is <span class="subst">$&#123;<span class="keyword">this</span>.score&#125;</span>.`</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>因為原型鏈的關係，當執行 roman.hi() 時，就會優先執行 Student 中定義的 hi。</p>
<h3 id="Encapsulation-封裝"><a href="#Encapsulation-封裝" class="headerlink" title="Encapsulation (封裝)"></a>Encapsulation (封裝)</h3><p>無法直接存取底線開頭 (underscore) 的屬性或方法，藉由公開的 hi() 來呼叫 __hi() 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.name = name || <span class="string">'default'</span>;</span><br><span class="line"> <span class="keyword">this</span>.age = age || <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">this</span>.skill= [<span class="string">'HTML'</span>,<span class="string">'CSS'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// protected</span></span><br><span class="line">Person.prototype.__hi= <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">`Hi, <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> ,My age is <span class="subst">$&#123;<span class="keyword">this</span>.age&#125;</span>.`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// public</span></span><br><span class="line">Person.prototype.hi= <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.__hi();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> roman = <span class="keyword">new</span> Person(<span class="string">'roman'</span>,<span class="string">'18'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Hi, roman ,My age is 18.</span></span><br><span class="line">roman.hi();</span><br></pre></td></tr></table></figure>

<p>靜態屬性或方法在 JavaScript 中的實作方式，是直接將方法或屬性加在 constructor function 上。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age</span>) </span>&#123;</span><br><span class="line">  Person.count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 靜態屬性</span></span><br><span class="line">Person.count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 靜態方法</span></span><br><span class="line">Person.getCount = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;Person.count&#125;</span>.`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Person();</span><br><span class="line"><span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 顯示 2</span></span><br><span class="line">Person.getCount();</span><br></pre></td></tr></table></figure>

<h3 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h3><ol>
<li><p><a href="https://www.fooish.com/javascript/oop-object-oriented-programming.html" target="_blank" rel="noopener">https://www.fooish.com/javascript/oop-object-oriented-programming.html</a></p>
</li>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10196763" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10196763</a></p>
</li>
<li><p><a href="https://pjchender.github.io/2018/08/01/js-%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91-javascript-object-oriented-javascript/" target="_blank" rel="noopener">https://pjchender.github.io/2018/08/01/js-%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91-javascript-object-oriented-javascript/</a></p>
</li>
<li><p><a href="https://github.com/noahlam/articles/blob/master/JS%E4%B8%AD%E7%9A%84%E7%BB%A7%E6%89%BF(%E4%B8%8A).md" target="_blank" rel="noopener">https://github.com/noahlam/articles/blob/master/JS%E4%B8%AD%E7%9A%84%E7%BB%A7%E6%89%BF(%E4%B8%8A).md</a></p>
</li>
</ol>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-2019-11-19-JavaScript-18"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="../../2019/12/12/2019-11-19-JavaScript-18/">JavaScript 原型鏈（Prototype Chain）</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="../../2019/12/12/2019-11-19-JavaScript-18/" class="article-date">
	  <time datetime="2019-12-11T16:00:00.000Z" itemprop="datePublished">十二月 12, 2019</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="logo.svg" style="width:15%;">

<br/>

<p><br/><br/></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>物件導向程式設計（OOP）的基本概念是使用物件的方式來表示，透過類別（class）的函式建構式（function constructor）可以產生物件實例（object instance）。</p>
<p>JavaScript 並非真正的物件導向 (OO) 語言，它是一個以原型為基礎 (Prototype-based) 的語言。因為沒有 Class，而是透過 「原型」(prototype) 來實現繼承實作。</p>
<h2 id="建構式"><a href="#建構式" class="headerlink" title="建構式"></a>建構式</h2><p>在 JavaScript 中，一個 Function 是不是建構式並不是取決於它的宣告方式，而是取決於它是不是用 new 來執行的。如果是用 new 執行一個 Function 時，我們就稱做這種呼叫為 <strong>建構式呼叫</strong>。當我們用<strong>建構式呼叫</strong>去執行一個 Function，這個 Function 就會被當作建構式。</p>
<p>使用 <code>new</code> 建構式呼叫的時候，實際上會有幾件事會被執行：</p>
<ul>
<li>首先會新建出一個物件。</li>
<li>將物件的  <code>.__proto__</code>  指向建構子的 prototype ，形成原型串鏈。</li>
<li>將建構子的 this 指向 new 出來的新物件。</li>
<li>回傳新建物件 ( 如果建構式本身沒有回傳東西的話 )。</li>
</ul>
<p>先來看一下 function constructor 的實際應用，透過 function 的方式來建立一個新的物件，如果我們想要建立出同屬性名稱但不同屬性值的物件內容，我們可以把物件的屬性值變成參數，如此就能透過此 function constructor 建立出許多不同的物件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">firstName, lastName, age</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">  <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">  <span class="keyword">this</span>.age = age;</span><br><span class="line">  <span class="keyword">this</span>.log = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.firstName+<span class="string">' '</span>+<span class="keyword">this</span>.lastName+ <span class="string">', age:'</span> + <span class="keyword">this</span>.age);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> roman = <span class="keyword">new</span> Person(<span class="string">'Roman'</span>,<span class="string">'Gonzalez'</span>, <span class="number">18</span>);</span><br><span class="line">roman.log(); <span class="comment">// Roman Gonzalez, age:18</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bobby = <span class="keyword">new</span> Person(<span class="string">'Bobby'</span>,<span class="string">'Lashley'</span>, <span class="number">20</span>);</span><br><span class="line">bobby.log(); <span class="comment">// Bobby Lashley, age:20</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(roman.log === bobby.log) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p> name 跟 age 這兩個屬性在每一個 instance 都不一定會相同，而 log 這個 method 其實都在做同一件事情，而且還佔用了兩份空間。意思就是他們其實是兩個不同的 function 。</p>
<p>因為每一個 instance 彼此之間是可以共享方法的，所以我們可以透過把 log 這個 function 抽出來，指定在 Person.prototype 上面，這樣所有用 Person 建構出來的 instance 都可以共享這個方法，將可以有效減少記憶體占用的問題。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">firstName, lastName, age</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line"> <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line"> <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Person.prototype.log = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.firstName+<span class="string">' '</span>+<span class="keyword">this</span>.lastName+ <span class="string">', age:'</span> + <span class="keyword">this</span>.age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> roman = <span class="keyword">new</span> Person(<span class="string">'Roman'</span>,<span class="string">'Gonzalez'</span>, <span class="number">18</span>);</span><br><span class="line"><span class="keyword">var</span> bobby = <span class="keyword">new</span> Person(<span class="string">'Bobby'</span>,<span class="string">'Lashley'</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(roman.log === bobby.log) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>共用的屬性或方法，不用每次都幫實體建立一份，提出來放到 prototype 即可。</p>
<p>以下是嘗試存取屬性時會發生的事：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 利用含有 a 與 b 屬性的 f 函式，建立一個 o 物件：</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.a = <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">this</span>.b = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o = <span class="keyword">new</span> f(); <span class="comment">// &#123;a: 1, b: 2&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接著針對 f 函式的原型添加屬性</span></span><br><span class="line">f.prototype.b = <span class="number">3</span>;</span><br><span class="line">f.prototype.c = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o.a); <span class="comment">// 1</span></span><br><span class="line"><span class="comment">// o 有屬性「a」嗎？有，該數值為 1。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o.b); <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// o 有屬性「b」嗎？有，該數值為 2。</span></span><br><span class="line"><span class="comment">// o 還有個原型屬性「b」，但這裡沒有被訪問到。</span></span><br><span class="line"><span class="comment">// 這稱作「property shadowing」。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o.c); <span class="comment">// 4</span></span><br><span class="line"><span class="comment">// o 有屬性「c」嗎？沒有，那就找 o 的原型看看。</span></span><br><span class="line"><span class="comment">// o 在「o.[[Prototype]]」有屬性「c」嗎？有，該數值為 4。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o.d); <span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// o 有屬性「d」嗎？沒有，那就找 o 的原型看看。</span></span><br><span class="line"><span class="comment">// o 在「o.[[Prototype]]」有屬性「d」嗎？沒有，那就找 o.[[Prototype]] 的原型看看。</span></span><br><span class="line"><span class="comment">// o 在「o.[[Prototype]].[[Prototype]]」是 null，停止搜尋。</span></span><br><span class="line"><span class="comment">// 找不到任何屬性，回傳 undefined。</span></span><br></pre></td></tr></table></figure>

<h3 id="增加原生原型的屬性和方法"><a href="#增加原生原型的屬性和方法" class="headerlink" title="增加原生原型的屬性和方法"></a>增加原生原型的屬性和方法</h3><p>上面都是設定自己建立的物件原型，也能修改預設的原生原型，但不要不小心把原本內建的屬性或方法給無意間覆蓋掉。</p>
<p>例如在 Array.prototype 上面加上函式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.push(<span class="string">"Cyting"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myname = [];</span><br><span class="line">myname[<span class="number">0</span>];    <span class="comment">//"Cyting"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ting = [];</span><br><span class="line">ting[<span class="number">0</span>];     <span class="comment">//"Cyting"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.prototype.top = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>[<span class="number">0</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">myname.top(); <span class="comment">//"Cyting"</span></span><br><span class="line">ting.top(); <span class="comment">//"Cyting"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span>.prototype.isLengthGreaterThan = <span class="function"><span class="keyword">function</span>(<span class="params">limit</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.length &gt; limit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Cyting"</span>.isLengthGreaterThan(<span class="number">4</span>));    <span class="comment">//  True</span></span><br></pre></td></tr></table></figure>

<p>在 Array.prototype 中 push 一段字串進去，接著新增 top 函式回傳字串內容；只要宣告出陣列型別的資料型態，都會有該字串內容，也都能呼叫 top 函式。</p>
<h3 id="修改-Prototype-方法"><a href="#修改-Prototype-方法" class="headerlink" title="修改 Prototype 方法"></a>修改 Prototype 方法</h3><p>我們可以修改某個 function constructor 的 prototype 內容，當改變了該函式建構式中 prototype 內的方法，那麼所有根據這個建構式所建立的實例（不管是修改 prototype 之前或之後所建立的實例），都會套用更新後的方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">firstName, lastName, age</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line"> <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line"> <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Person.prototype.log = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">`Hi <span class="subst">$&#123;<span class="keyword">this</span>.firstName&#125;</span> <span class="subst">$&#123;<span class="keyword">this</span>.lastName&#125;</span>`</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> roman = <span class="keyword">new</span> Person(<span class="string">'Roman'</span>,<span class="string">'Gonzalez'</span>, <span class="number">18</span>);</span><br><span class="line">roman.log(); <span class="comment">// Hi Roman  Gonzalez</span></span><br><span class="line"><span class="keyword">var</span> bobby = <span class="keyword">new</span> Person(<span class="string">'Bobby'</span>,<span class="string">'Lashley'</span>, <span class="number">20</span>);</span><br><span class="line">bobby.log(); <span class="comment">// Hi Bobby  Lashley</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改原本的 log 方法</span></span><br><span class="line">Person.prototype.log= <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Hello, <span class="subst">$&#123;<span class="keyword">this</span>.firstName&#125;</span> <span class="subst">$&#123;<span class="keyword">this</span>.lastName&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">roman.log();  <span class="comment">// Hello, Roman  Gonzalez</span></span><br><span class="line">bobby.log();  <span class="comment">// Hello, Bobby  Lashley</span></span><br></pre></td></tr></table></figure>

<h3 id="原型鏈-Prototype-Chain"><a href="#原型鏈-Prototype-Chain" class="headerlink" title="原型鏈 Prototype Chain"></a>原型鏈 Prototype Chain</h3><p>當物件試圖存取一個物件的屬性時，其不僅會尋找該物件，也會尋找該物件的原型、原型的原型……直到找到相符合的屬性，或是到達原型鏈的尾端。</p>
<p>所有的物件裡面都會包含原型（prototype）這個物件，在 JavaScript 中這個物件的名稱為  <code>__proto__</code>  。如果在原本的物件中找不到指定的屬性名稱或方法時，就會進一步到 <code>__proto__</code>  裡面來找。</p>
<p>以上面 var roman = new Person(‘Roman’,’Gonzalez’, 18); 為例，當呼叫  roman.log() 方法，因為 roman 這個 instance 本身並沒有 log 這個 function，而 roman 是 Person 的 instance，所以如果在 roman 本身找不到，就會嘗試從  Person.prototype 去找。</p>
<p>我們想要取得某個物件的原型物件時，就可以透過以下兩個方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以使用 .__proto__ 來取得 [[Prototype]] </span></span><br><span class="line">roman.__proto__ === Person.prototype <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//也可以用 Object.getPrototypeOf(..)來取得 [[Prototype]]</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(roman) === Person.prototype <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p> roman 的 <code>__proto__</code>  會指向 <code>Person.prototype</code>  ，當發現 roman 沒有 log 這個 method 的時候，JavaScript 就會試著透過 <code>__proto__</code>  找到  <code>Person.prototype</code>  ，去看 <code>Person.prototype</code>  裡面有沒有 log 這個 method。</p>
<p>假如  <code>Person.prototype</code>  還是沒有呢？那就繼續依照這個規則，去看  <code>Person.prototype.__proto__</code>  裡面有沒有 log 這個 method，就這樣一直不斷找下去。直到該物件的 <code>__proto__</code>  為 null 為止，意思就是找到最上層了。</p>
<p>而上面這一條透過 <code>__proto__</code>  不斷串起來的鍊，就稱為<strong>原型鍊</strong>。透過這一條原型鍊來呼叫自己 parent 的 method，讓 JavaScript 達到類似其他物件導向語言般的類別、繼承功能。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// roman.__proto__ 會指向 Person.prototype</span></span><br><span class="line"><span class="built_in">console</span>.log(roman.__proto__ === Person.prototype) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Person.prototype.__proto__ 會指向 Object.prototype</span></span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype.__proto__ === <span class="built_in">Object</span>.prototype) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object.prototype.__proto__ 會指向 null，這就是原型鍊的頂端了</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.__proto__) <span class="comment">// null</span></span><br></pre></td></tr></table></figure>

<h3 id="hasOwnProperty-NaN"><a href="#hasOwnProperty-NaN" class="headerlink" title="hasOwnProperty"></a>hasOwnProperty</h3><p>如果想知道一個屬性是存在 instance 身上，還是存在於它屬於的原型鍊當中，可以用 hasOwnProperty 這個方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> roman = <span class="keyword">new</span> Person(<span class="string">'Roman'</span>,<span class="string">'Gonzalez'</span>, <span class="number">18</span>);</span><br><span class="line"><span class="built_in">console</span>.log(roman.hasOwnProperty(<span class="string">'log'</span>)); <span class="comment">// false</span></span><br><span class="line"><span class="built_in">console</span>.log(roman.__proto__.hasOwnProperty(<span class="string">'log'</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p> hasOwnProperty 只會檢查該物件，而不會檢查整條原型串鏈；可以透過迴圈來列出整個原型鏈且為可列舉的屬性；prop 是自訂的變數，會把該物件的屬性存在這個變數中，接著讀取下一個屬性，重覆直到沒有屬性為止，透過 for…in 把該物件中的所有屬性名稱和屬性值都列出來，列出的項目也包含被添加過的屬性或方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> prop <span class="keyword">in</span> roman) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(prop);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//firstName</span></span><br><span class="line"><span class="comment">//lastName</span></span><br><span class="line"><span class="comment">//age</span></span><br><span class="line"><span class="comment">//log</span></span><br></pre></td></tr></table></figure>

<h3 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h3><p>檢查物件是否為指定的建構子所建立的實體，位於 instanceof 左邊的運算元是物件，右邊的是函式，若左邊的物件是由右邊函式所產生的，則會回傳 true，否則為 false。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">roman <span class="keyword">instanceof</span> Person    <span class="comment">// true</span></span><br><span class="line">roman <span class="keyword">instanceof</span> <span class="built_in">Object</span>    <span class="comment">// true</span></span><br><span class="line">roman <span class="keyword">instanceof</span> <span class="built_in">Array</span>     <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>  <code>A instanceof B</code>  就是拿來判斷 A 是不是 B 的 instance 只要能在 A 的原型鍊裡面找到 B 的 prototype，就會回傳 true。</p>
<h3 id="isPrototypeOf-NaN"><a href="#isPrototypeOf-NaN" class="headerlink" title="isPrototypeOf"></a>isPrototypeOf</h3><p>與 instanceof 不同之處只在於運算元的資料型別不同而已，但功能是相同的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype.isPrototypeOf(roman)  <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.isPrototypeOf(roman)  <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.isPrototypeOf(roman)   <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>如果  <code>A.isPrototypeOf(B)</code> 返回 true 則  <code>B instanceof A</code>  一定返回 true 。</p>
<h3 id="Object-prototype"><a href="#Object-prototype" class="headerlink" title="Object.prototype"></a>Object.prototype</h3><p>當我們嘗試在某個物件存取一個不存在該物件的屬性時，它會繼續往它的「原型物件」<code>[[prototype]]</code> 去尋找，直到找到  <code>Object.prototype</code>  才停止。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 這兩個互為彼此的 instance</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span> <span class="keyword">instanceof</span> <span class="built_in">Object</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span> <span class="keyword">instanceof</span> <span class="built_in">Function</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Function 的 __proto__ 會指向 Function.prototype</span></span><br><span class="line"><span class="comment">// Function.prototype 的 __proto__ 會指向 Object.prototype</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>.__proto__ === <span class="built_in">Function</span>.prototype); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>.__proto__.__proto__ === <span class="built_in">Object</span>.prototype); <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Object 的 __proto__ 會指向 Function.prototype</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.__proto__ === <span class="built_in">Function</span>.prototype); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Person.__proto__ === <span class="built_in">Function</span>.prototype); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>.prototype.__proto__ === <span class="built_in">Object</span>.prototype) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.__proto__); <span class="comment">//null</span></span><br></pre></td></tr></table></figure>

<h3 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h3><p>每一個 prototype 都會有一個有 constructor 屬性，而這個屬性會指向構造函數，例如 Person.prototype 的構造函數就是Person。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">firstName, lastName, age</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line"> <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line"> <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Person.prototype.log = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">`Hi <span class="subst">$&#123;<span class="keyword">this</span>.firstName&#125;</span>  <span class="subst">$&#123;<span class="keyword">this</span>.lastName&#125;</span>`</span>);</span><br><span class="line"> &#125;</span><br><span class="line"><span class="keyword">var</span> roman = <span class="keyword">new</span> Person(<span class="string">'Roman'</span>,<span class="string">'Gonzalez'</span>, <span class="number">18</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 往原型鍊去找</span></span><br><span class="line"><span class="built_in">console</span>.log(roman.constructor === Person); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(roman.hasOwnProperty(<span class="string">'constructor'</span>)); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Person 的 constructor 就是 Person</span></span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype.constructor === Person); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype.hasOwnProperty(<span class="string">'constructor'</span>)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p> <code>X.prototype.constructor === X</code>  ，將 X 用 Function, Person, Object 帶進去都會是 true。</p>
<h3 id="Object-create-and-new-operator-差異"><a href="#Object-create-and-new-operator-差異" class="headerlink" title="Object.create() and new operator 差異"></a>Object.create() and new operator 差異</h3><p>以下為使用 Object.create 方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dog = &#123;</span><br><span class="line">    eat: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.eatFood)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> maddie = <span class="built_in">Object</span>.create(dog);</span><br><span class="line"><span class="built_in">console</span>.log(dog.isPrototypeOf(maddie)); <span class="comment">//true</span></span><br><span class="line">maddie.eatFood = <span class="string">'NomNomNom'</span>; </span><br><span class="line">maddie.eat(); <span class="comment">//NomNomNom</span></span><br></pre></td></tr></table></figure>

<p>執行流程如下：</p>
<ol>
<li>建立一個 dog 物件。</li>
<li>使用 Object.create(dog)  將 將 maddie 的 [[Prototype]] 指向 dog 。</li>
<li>檢查 maddie 的 prototype 是不是 dog，回傳 true 。</li>
<li>設定 maddie 的 eatFood 屬性值。</li>
<li>呼叫 eat function。</li>
<li>Javascript 透過 prototype chain 找到 eat method 。</li>
</ol>
<p>以下為使用 new operator 方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Dog = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.eatFood = <span class="string">'NomNomNom'</span>;</span><br><span class="line">    <span class="keyword">this</span>.eat = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.eatFood)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> maddie = <span class="keyword">new</span>(Dog);</span><br><span class="line"><span class="built_in">console</span>.log(maddie <span class="keyword">instanceof</span> Dog); <span class="comment">// True</span></span><br><span class="line">maddie.eat(); <span class="comment">//NomNomNom</span></span><br></pre></td></tr></table></figure>

<p>執行流程如下：</p>
<p>建立一個 maddie 物件。</p>
<ol>
<li>透過 function constructor 將 maddie 的 [[Prototype]] 指向 Dog 的  Prototype。</li>
<li>設定建構式中的 this 到物件。</li>
<li>回傳所建立的物件。</li>
<li>檢查 maddie 是不是 Dog 的 instance ，回傳 true 。</li>
<li>呼叫 eat function。</li>
<li>Javascript 透過 prototype chain 找到 eat method 。</li>
</ol>
<p>再看一個例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.pupper = <span class="string">'Pupper'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Dog.prototype.pupperino = <span class="string">'Pups.'</span>;</span><br><span class="line"><span class="keyword">var</span> maddie = <span class="keyword">new</span> Dog();</span><br><span class="line"><span class="keyword">var</span> buddy = <span class="built_in">Object</span>.create(Dog.prototype);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Using Object.create()</span></span><br><span class="line"><span class="built_in">console</span>.log(buddy.pupper); <span class="comment">//Output is undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(buddy.pupperino); <span class="comment">//Output is Pups.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Using New Keyword</span></span><br><span class="line"><span class="built_in">console</span>.log(maddie.pupper); <span class="comment">//Output is Pupper</span></span><br><span class="line"><span class="built_in">console</span>.log(maddie.pupperino); <span class="comment">//Output is Pups.</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(buddy.pupper); <span class="comment">//Output is undefined</span></span><br></pre></td></tr></table></figure>

<p>大家有注意到 <strong>buddy.pupper</strong> 是 <strong>undefined</strong> 嗎？即使 Object.create() 將 prototype 指定為 Dog ，但是 buddy 並沒有存取到建構式中的 <strong>this.pupper</strong> ，兩者之間的主要差別就是 new Dog 會執行建構式中的程式碼，而 object.create 並不會執行建構式裡面的內容。</p>
<p>以下為另一個範例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.prop1 = <span class="string">'prop1'</span>;</span><br><span class="line">    <span class="keyword">this</span>.prop2 = <span class="string">'prop2'</span>;</span><br><span class="line">    <span class="keyword">this</span>.func1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.prop1 + <span class="keyword">this</span>.prop2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Test.prototype.protoProp1 = <span class="string">'protoProp1'</span>;</span><br><span class="line">Test.prototype.protoProp2 = <span class="string">'protoProp2'</span>;</span><br><span class="line"><span class="keyword">var</span> newKeywordTest = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="keyword">var</span> objectCreateTest = <span class="built_in">Object</span>.create(Test.prototype);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Object.create   */</span></span><br><span class="line"><span class="built_in">console</span>.log(objectCreateTest.prop1); <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(objectCreateTest.protoProp1); <span class="comment">// protoProp1 </span></span><br><span class="line"><span class="built_in">console</span>.log(objectCreateTest.__proto__.protoProp1); <span class="comment">// protoProp1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* new    */</span></span><br><span class="line"><span class="built_in">console</span>.log(newKeywordTest.prop1); <span class="comment">// prop1</span></span><br><span class="line"><span class="built_in">console</span>.log(newKeywordTest.__proto__.protoProp1); <span class="comment">// protoProp1</span></span><br></pre></td></tr></table></figure>

<p>此範例比較三個不同的建立方式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.prop1 = <span class="string">'prop1'</span>;</span><br><span class="line"> <span class="keyword">this</span>.prop2 = <span class="string">'prop2'</span>;</span><br><span class="line"> <span class="keyword">this</span>.func1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">this</span>.prop1 + <span class="keyword">this</span>.prop2;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Test.prototype.protoProp1 = <span class="string">'protoProp1'</span>;</span><br><span class="line">Test.prototype.protoProp2 = <span class="string">'protoProp2'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">Object</span>.create(Test.prototype);</span><br><span class="line"><span class="keyword">var</span> c = <span class="built_in">Object</span>.create(Test);</span><br></pre></td></tr></table></figure>

<p>讓我們來看一下 a ,b ,c 三個物件內容在 console 輸出的結果：</p>
<img src="2019-11-19-JavaScript-18-1.PNG" style="width:50%;">

<img src="2019-11-19-JavaScript-18-2.PNG" style="width:50%;">

<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>所謂的 Prototype 就是原型，所有函式上面都有預設有一個公開的 Prototype 屬性，而被此建構式新建出來的物件都可以透過 <code>[[Prototype]]</code> 參考連結到這個原型物件上來存取其上的屬性，也就能建立出 <em>類似物件導向概念</em> 的程式。</p>
<p>整理一下本篇中出現的名詞：</p>
<ul>
<li><p><code>Prototype</code>：</p>
<p>也就是原型物件。</p>
<p>所有函式上面都有預設有一個公開的 Prototype 屬性(原型物件)。被函式建立出的物件都可以存取其對應的原型物件。</p>
</li>
<li><p><code>[[Prototype]]</code>：</p>
<p>用來讓物件能夠連結到其原型物件上的一個參考。</p>
<p>這是一個不允許外部存取的屬性。</p>
</li>
<li><p><code>__proto__</code>：</p>
<p>相當於可存取的 <code>[[Prototype]]</code>，為了方便存取 <code>Prototype</code> 而生。</p>
<p>雖已於 ES6 中列為標準，但為了效能考量還是不建議使用。</p>
</li>
</ul>
<h3 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h3><ol>
<li><p><a href="https://blog.techbridge.cc/2017/04/22/javascript-prototype/" target="_blank" rel="noopener">https://blog.techbridge.cc/2017/04/22/javascript-prototype/</a></p>
</li>
<li><p><a href="https://cythilya.github.io/2018/10/26/prototype/" target="_blank" rel="noopener">https://cythilya.github.io/2018/10/26/prototype/</a></p>
</li>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10194356" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10194356</a></p>
</li>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10196639" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10196639</a></p>
</li>
<li><p><a href="https://pjchender.github.io/2018/08/01/js-%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91-javascript-object-oriented-javascript/" target="_blank" rel="noopener">https://pjchender.github.io/2018/08/01/js-%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91-javascript-object-oriented-javascript/</a></p>
</li>
<li><p><a href="https://medium.com/@jonathanvox01/understanding-the-difference-between-object-create-and-the-new-operator-b2a2f4749358" target="_blank" rel="noopener">https://medium.com/@jonathanvox01/understanding-the-difference-between-object-create-and-the-new-operator-b2a2f4749358</a></p>
</li>
<li><p><a href="https://stackoverflow.com/questions/4166616/understanding-the-difference-between-object-create-and-new-somefunction" target="_blank" rel="noopener">https://stackoverflow.com/questions/4166616/understanding-the-difference-between-object-create-and-new-somefunction</a></p>
</li>
</ol>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-2019-11-17-JavaScript-16"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="../../2019/11/19/2019-11-17-JavaScript-16/">JavaScript Copy</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="../../2019/11/19/2019-11-17-JavaScript-16/" class="article-date">
	  <time datetime="2019-11-18T16:00:00.000Z" itemprop="datePublished">十一月 19, 2019</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="logo.svg" style="width:15%;">

<br/>

<p><br/><br/></p>
<p>如果我想要複製物件的值，卻不希望在複製後，只要更動其值，原變數也會受到影響，該怎麼做呢？</p>
<p>本篇將介紹關於 JavaScript 中的「淺拷貝」以及「深拷貝」。</p>
<br/>

<p>原始型別在賦值時一般是直接傳值的方式(pass by value)：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a= <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b = a;</span><br><span class="line">b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">//1</span></span><br><span class="line"><span class="built_in">console</span>.log(b); <span class="comment">//2</span></span><br></pre></td></tr></table></figure>

<p>但是物件會是傳指標(pass by Reference)：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123; <span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">let</span> obj2 = obj1;</span><br><span class="line">obj2.b = <span class="number">4</span></span><br><span class="line">​</span><br><span class="line"><span class="built_in">console</span>.log(obj1) <span class="comment">//&#123; a:1, b:4, c:3&#125; </span></span><br><span class="line"><span class="built_in">console</span>.log(obj2) <span class="comment">//&#123; a:1, b:4, c:3&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="淺拷貝-Shallow-Copy"><a href="#淺拷貝-Shallow-Copy" class="headerlink" title="淺拷貝 Shallow Copy"></a>淺拷貝 Shallow Copy</h3><p>原本  <code>a</code>  和  <code>b</code>  是指向同一塊記憶體位址；透過重新賦值的方式，讓  <code>b</code>  指向一個新的記憶體位址：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="attr">name</span>: <span class="string">'William'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = a;</span><br><span class="line"></span><br><span class="line">b = &#123;<span class="attr">name</span>: <span class="string">"Teddy"</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a.name); <span class="comment">// William</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(b.name); <span class="comment">// Teddy</span></span><br></pre></td></tr></table></figure>

<p>同樣的範例還有這個，我們直接把 a 取出的值放到屬性名稱後面：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="attr">name</span>: <span class="string">'William'</span>, <span class="attr">age</span>: <span class="number">70</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = &#123;<span class="attr">name</span>: a.name, <span class="attr">age</span>: a.age&#125;;</span><br><span class="line"></span><br><span class="line">b.name = <span class="string">"Teddy"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a.name); <span class="comment">// William</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(b.name); <span class="comment">// Teddy</span></span><br></pre></td></tr></table></figure>

<p>也可以使用 Object.assign 的方式來複製：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="attr">name</span>: <span class="string">'William'</span>, <span class="attr">age</span>: <span class="number">70</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">Object</span>.assign(&#123;&#125;, a);</span><br><span class="line">b.name = <span class="string">"Teddy"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a.name); <span class="comment">// William</span></span><br><span class="line"><span class="built_in">console</span>.log(b.name); <span class="comment">// Teddy</span></span><br></pre></td></tr></table></figure>

<h5 id=""><a href="#" class="headerlink" title=""></a><br/></h5><h5 id="但是以上使用淺拷貝只能複製一層。"><a href="#但是以上使用淺拷貝只能複製一層。" class="headerlink" title="但是以上使用淺拷貝只能複製一層。"></a>但是以上使用淺拷貝只能複製一層。</h5><br/>

<p>當拷貝到第二層的時候就會發生問題：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line"></span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">    b: &#123;</span><br><span class="line"></span><br><span class="line">        b1: <span class="number">2</span>,</span><br><span class="line"></span><br><span class="line">        b2: <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = <span class="built_in">Object</span>.assign(&#123;&#125;, obj);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj2.a= <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">obj2.b.b1= <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.a); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.b.b1); <span class="comment">// 20</span></span><br></pre></td></tr></table></figure>

<p>物件  <code>obj2</code>  改變 <code>a</code>  並不會影響物件 <code>obj</code>  的  <code>a</code>  ，但是改變再深一層的物件的值，就會影響到原本  <code>a</code>  的  <code>b.b1</code>  了!</p>
<p>讓我們在看一個例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123;<span class="attr">a</span>:&#123;<span class="attr">b</span>:<span class="number">5</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">let</span> obj2 = &#123;<span class="attr">a</span>:obj1.a&#125;;<span class="comment">//都把a指派到&#123;b:5&#125;這個物件的reference</span></span><br><span class="line">obj2.a.b = <span class="number">10</span></span><br><span class="line">​</span><br><span class="line"><span class="built_in">console</span>.log(obj1) <span class="comment">//&#123;a:&#123;b:10&#125;&#125;; 被指派到10</span></span><br><span class="line"><span class="built_in">console</span>.log(obj2) <span class="comment">//&#123;a:&#123;b:10&#125;&#125;; </span></span><br><span class="line"><span class="built_in">console</span>.log(obj1 === obj2) <span class="comment">//false 實際上不是同物件    </span></span><br><span class="line"><span class="built_in">console</span>.log(obj1.a === obj2.a) <span class="comment">//true 但是第二層物件實際上相同</span></span><br></pre></td></tr></table></figure>

<p>當我們要確保物件是整個複製，而不是只複製 reference 時就需要用到 <strong>Deep</strong> <strong>Copy</strong> 。</p>
<h3 id="深拷貝-Deep-Copy"><a href="#深拷貝-Deep-Copy" class="headerlink" title="深拷貝 Deep Copy"></a>深拷貝 Deep Copy</h3><p>JSON.parse(JSON.stringify(object_array)):</p>
<ul>
<li>JSON.parse():把字串轉成物件</li>
<li>JSON.stringify():把物件轉成字串。</li>
</ul>
<p>我們可以把物件先轉換成 JSON 再 parse 回來</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">     a: <span class="number">1</span>,</span><br><span class="line">     b: &#123;</span><br><span class="line">         b1: <span class="number">2</span>,</span><br><span class="line">         b2: <span class="number">3</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj));</span><br><span class="line"></span><br><span class="line">obj2.a= <span class="number">10</span>;</span><br><span class="line">obj2.b.b1= <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.a); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.b.b1); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<p>也可以透過使用第三方套件(ex: JQuery、lodash)的方式：</p>
<h5 id="Lodash"><a href="#Lodash" class="headerlink" title="Lodash"></a>Lodash</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">     a: <span class="number">1</span>,</span><br><span class="line">     b: &#123;</span><br><span class="line">         b1: <span class="number">2</span>,</span><br><span class="line">         b2: <span class="number">3</span></span><br><span class="line">      &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = cloneDeep(obj);</span><br></pre></td></tr></table></figure>

<h5 id="Jquery"><a href="#Jquery" class="headerlink" title="Jquery"></a>Jquery</h5><p>深拷貝和淺拷貝對應的參數是 true 或 false 。<br>預設情況是 false（淺拷貝），而且 false 不能夠寫出來，也就是你想要淺拷貝，那就什麼參數都不用帶。如果想帶入參數，只能傳入 true（深拷貝）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">     a: <span class="number">1</span>,</span><br><span class="line">     b: &#123;</span><br><span class="line">         b1: <span class="number">2</span>,</span><br><span class="line">         b2: <span class="number">3</span></span><br><span class="line">     &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 深拷貝</span></span><br><span class="line"></span><br><span class="line">$.extend(<span class="literal">true</span>, obj, obj2);</span><br><span class="line"></span><br><span class="line">obj.b.b1= <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b 並沒有因為 a 的改動也跟著改動</span></span><br><span class="line"><span class="built_in">console</span>.log(obj2.b.b1); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 至於沒有加上參數就是淺拷貝</span></span><br><span class="line">$.extend(obj,obj2);</span><br></pre></td></tr></table></figure>

<h3 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h3><ol>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10200860" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10200860</a></p>
</li>
<li><p><a href="https://dustinhsiao21.com/2018/01/07/javascript-shallow-copy-and-deep-copy/" target="_blank" rel="noopener">https://dustinhsiao21.com/2018/01/07/javascript-shallow-copy-and-deep-copy/</a></p>
</li>
</ol>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-2019-11-18-JavaScript-17"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="../../2019/11/18/2019-11-18-JavaScript-17/">JavaScript THIS</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="../../2019/11/18/2019-11-18-JavaScript-17/" class="article-date">
	  <time datetime="2019-11-17T16:00:00.000Z" itemprop="datePublished">十一月 18, 2019</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="logo.svg" style="width:15%;">

<br/>

<p><br/><br/></p>
<p>this 是 JavaScript 的一個關鍵字， this 會在不同的情境下指稱到不同的物件。</p>
<p>this 在物件導向裡面，它所代表的就是那個 instance 本身：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  setName(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getName() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myCar = <span class="keyword">new</span> Car()</span><br><span class="line">myCar.setName(<span class="string">'Ford'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(myCar.getName()) <span class="comment">// Ford</span></span><br></pre></td></tr></table></figure>

<p>在上面我們宣告了一個 class <code>Car</code>，寫了 setName 跟 getName 兩個方法，在裡面用<code>this.name</code>來取放這個 instance 的屬性，<code>myCar.setName(&#39;Ford&#39;)</code>，所以 this 就會是<code>myCar</code>。</p>
<h3 id="this-不等於-function"><a href="#this-不等於-function" class="headerlink" title="this 不等於 function"></a>this 不等於 function</h3><p>如果直接調用函式，此函式的 this 會指向 window 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.say = <span class="string">'Hi'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CallSay</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.say); <span class="comment">// Hi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CallSay();</span><br></pre></td></tr></table></figure>

<p><code>this</code>  不會指到 <code>CallSay</code>  這個 function，實際上是指向  <code>window</code>  。</p>
<p>再看一個範例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> call = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">    <span class="built_in">console</span>.log( <span class="keyword">this</span>.name );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> say = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">'Felix'</span>;  </span><br><span class="line">    <span class="keyword">this</span>.call();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">say();</span><br></pre></td></tr></table></figure>

<p>在這個範例中， <code>say</code> 可以透過 <code>this.call</code> 取得 <code>call</code> ，是因為 <code>this.call</code> 實際上是指向 <code>window.call</code>。<br>而 <code>call</code> 的 <code>this.name</code> 並非是 <code>say</code> 中的 <code>Felix</code> ，而是指向 <code>window.name</code> ，所以會得到 <code>undefined</code> 的結果。</p>
<br/>

<p>下個例子是將 function 內在包覆著 function，但只要是直接呼叫，this 都是屬於全域。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.say = <span class="string">'Hi'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CallSay</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'call:'</span>, <span class="keyword">this</span>.say); <span class="comment">//call: Hi</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// function 內的 function</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">CallSayNow</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'call me now:'</span>, <span class="keyword">this</span>.say);<span class="comment">//call me now: Hi</span></span><br><span class="line">  &#125;</span><br><span class="line">  CallSayNow();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CallSay();</span><br></pre></td></tr></table></figure>

<p>來看一下巢狀迴圈中的 this ：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line"></span><br><span class="line">  func1: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>); <span class="comment">//指到 func1 </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> func2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="comment">// 這裡的 this 跟上層不同！</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>);<span class="comment">// 指到 window</span></span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    func2();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.func1();</span><br></pre></td></tr></table></figure>

<p>在  <code>obj.func1()</code>  裡面的  <code>this</code>  會指向  <code>func1</code> ；是因為  <code>func1</code>  透過  <code>obj</code>  來呼叫的。</p>
<p>但  <code>obj.func1()</code>  裡面的 <code>func2()</code> 在執行時的  <code>this</code>  卻會指向 <code>window</code>。</p>
<p>也就是當沒有特定指明 this 的情況下，預設綁定 (Default Binding) this 為 「全域物件」，也就是 window。</p>
<p>以上這幾種情況， this 的值在瀏覽器底下就會是 <code>window</code>  ，在 node.js 底下會是  <code>global</code>  ，如果是在嚴格模式，this 的值就會是 <code>undefined</code>  。</p>
<h3 id="強制指定-this-的方式"><a href="#強制指定-this-的方式" class="headerlink" title="強制指定 this 的方式"></a>強制指定 this 的方式</h3><p>在 JavaScript 有三個可以強制指定 <code>this</code> 的方式，分別是 <code>call()</code> 、 <code>apply()</code> 以及 <code>bind()</code>。</p>
<p><code>call</code>  跟 <code>apply</code>  是很類似的方法，這兩種都是能夠呼叫 fucntion 的函式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">funA</span>(<span class="params">a, b</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>, a, b)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">funA(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// undefined 1 2</span></span><br><span class="line">funA.call(<span class="string">"Hector"</span>, <span class="number">1</span>, <span class="number">2</span>) <span class="comment">// Hector 1 2</span></span><br><span class="line"></span><br><span class="line">funA.apply(<span class="string">"Ray"</span>, [<span class="number">1</span>, <span class="number">2</span>]) <span class="comment">// Ray 1 2</span></span><br></pre></td></tr></table></figure>

<p>因為是嚴格模式所以  <code>funA(1, 2)</code>  的 this 是 <code>undefined</code>。</p>
<p><code>call</code> 和 <code>apply</code> 就是你第一個參數傳什麼，裡面 this 的值就會是什麼。儘管原本已經有 this，也依然會被覆蓋：</p>
<p>而兩者的差別只在於 <code>apply</code> 傳進去的參數是一個 array，所以上面這三種呼叫 function 的方式是等價的。除了直接呼叫 function 以外，你也可以用 call 或是 apply 去呼叫，差別在於傳參數的方式不同。</p>
<h5 id="除了以上兩種以外，還有最後一種可以改變-this-的方法：bind。"><a href="#除了以上兩種以外，還有最後一種可以改變-this-的方法：bind。" class="headerlink" title="除了以上兩種以外，還有最後一種可以改變 this 的方法：bind。"></a><strong>除了以上兩種以外，還有最後一種可以改變 this 的方法：bind。</strong></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">funA</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myFunA = funA.bind(<span class="string">'Hi'</span>)</span><br><span class="line"></span><br><span class="line">myFunA() <span class="comment">// Hi</span></span><br></pre></td></tr></table></figure>

<p>在這邊我們把  <code>funA</code>  這個 function 用  <code>Hi</code>  來綁定，所以最後呼叫  <code>myFunA</code>  時會輸出  <code>Hi</code>  。</p>
<p>在看一個例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  LastName: <span class="string">"Lincoln"</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.LastName);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">func();            <span class="comment">// undefined</span></span><br><span class="line">func.bind(obj)();  <span class="comment">// Lincoln</span></span><br></pre></td></tr></table></figure>

<p>加上了  <code>bind</code>  之後的  <code>func.bind(obj)()</code>  ，會替我們將  <code>func</code>  的  <code>this</code>  暫時指向我們所設定的 <code>obj</code>。<br>於是  <code>console.log(this.LastName)</code>  的結果自然就是  <code>obj.LastName</code>  也就是  <code>Lincoln</code>  了。</p>
<h3 id="重新指向-this"><a href="#重新指向-this" class="headerlink" title="重新指向 this"></a>重新指向 this</h3><p>假設我們今天在某個元素上透過  <code>addEventListener</code>  註冊了  <code>click</code>  事件，而在事件中的  <code>this</code>  指的是「觸發事件的元素」。</p>
<p>要是我們在事件的 callback function 加入 ajax 的請求，那麼根據前面所說的，預設綁定 (Default Binding) 會把這個 callback function 的  <code>this</code>  指定給  <code>global object</code>  ，也就是  <code>window</code>  。</p>
<p>如果需調用的則是物件本身的話，可以先用一個變數指向 <code>this</code>，等到調用後再重新使用它。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">el.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 透過 that 參考</span></span><br><span class="line">  <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">  <span class="built_in">console</span>.log( <span class="keyword">this</span>.textContent );</span><br><span class="line"></span><br><span class="line">  $ajax(<span class="string">'[URL]'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// this.textContent =&gt; undefined</span></span><br><span class="line">    <span class="built_in">console</span>.log(that.textContent, res);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>像這樣，我們將事件內的  <code>this</code>  先用一個叫  <code>that</code>  的變數儲存它的參考，那麼在 ajax 的 callback function 就可以透過  <code>that</code>  來存取到原本事件中的  <code>this</code>   了。</p>
<br/>

<h5 id="如果我們把-call-跟-bind-同時用會怎樣"><a href="#如果我們把-call-跟-bind-同時用會怎樣" class="headerlink" title="如果我們把 call 跟 bind 同時用會怎樣!?"></a><strong>如果我們把 call 跟 bind 同時用會怎樣!?</strong></h5><br/>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">funA</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">const</span> myFunA = funA.bind(<span class="string">'Hi'</span>)</span><br><span class="line"> myFunA.call(<span class="string">'Hello'</span>) <span class="comment">// Hi</span></span><br></pre></td></tr></table></figure>

<p>答案是不會改變，一但 bind 了以後值就不會改變了。</p>
<p><strong>在非嚴格模式底下，無論是用 call、apply 還是 bind，你傳進去的如果是基本型別都會被轉成 object</strong>  。</p>
<p>舉例來說：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">funA</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line"> &#125;</span><br><span class="line"> funA.call(<span class="number">1</span>) <span class="comment">// Number &#123;1&#125;</span></span><br><span class="line"> <span class="keyword">const</span> myFunA = funA.bind(<span class="string">'Hi'</span>)</span><br><span class="line"> myFunA() <span class="comment">// String &#123;"Hi"&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="物件中的-this"><a href="#物件中的-this" class="headerlink" title="物件中的 this"></a>物件中的 this</h3><p>最前面我們示範了在物件導向 class 裡面的 this，但在 JavaScript 裡面還有另外一種方式也是物件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  value: <span class="number">1</span>,</span><br><span class="line">  say: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.say() <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">const</span> hello = obj.say</span><br><span class="line">hello() <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<p>這種跟一開始的物件導向範例不太一樣，這個範例是直接創造了一個物件而沒有透過 class，所以你也不會看到 new 這個關鍵字的存在。</p>
<p>舉個簡單的例子來幫大家複習一下 Scope Chain：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  value: <span class="string">'value'</span>,</span><br><span class="line"></span><br><span class="line">  say1: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.value); <span class="comment">// value</span></span><br><span class="line"></span><br><span class="line">    say() <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  say2: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.value); <span class="comment">// value</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> value = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    say() <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">say() <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">obj.say1()</span><br><span class="line"></span><br><span class="line">obj.say2()</span><br></pre></td></tr></table></figure>

<p>無論怎麼呼叫 <code>say</code>  這個 function，印出來的 <code>value</code> 永遠都會是全域變數的   <code>value</code>  ，因為 <code>say</code>  在自己的作用域底下找不到  <code>value</code>  於是往上一層找，就會找到  global scope ，這跟你在哪裡呼叫 <code>say</code>  一點關係都沒有。 <code>say</code>  這個 function 在「定義」的時候就把 scope 給決定好了。</p>
<p>但 this 卻是完全相反，this 的值會根據你怎麼呼叫它而變得不一樣，像是先前我們剛講過的 call、apply 跟 bind ，你可以用不同的方式去呼叫 function，讓 this 的值變得不同。</p>
<br/>

<h5 id="this-的值跟作用域跟程式碼的位置在哪裡完全無關，只跟「如何呼叫」有關。"><a href="#this-的值跟作用域跟程式碼的位置在哪裡完全無關，只跟「如何呼叫」有關。" class="headerlink" title="this 的值跟作用域跟程式碼的位置在哪裡完全無關，只跟「如何呼叫」有關。"></a><strong>this 的值跟作用域跟程式碼的位置在哪裡完全無關，只跟「如何呼叫」有關。</strong></h5><br/>

<p>讓我們看複雜一點的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  value: <span class="number">1</span>,</span><br><span class="line">  say: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.value)</span><br><span class="line">  &#125;,</span><br><span class="line">  func2: &#123;</span><br><span class="line"></span><br><span class="line">    value: <span class="number">2</span>,</span><br><span class="line">    say: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2 = obj.func2</span><br><span class="line"><span class="keyword">const</span> say= obj.func2.say</span><br><span class="line"></span><br><span class="line">obj.func2.say()</span><br><span class="line"></span><br><span class="line">obj2.say()</span><br><span class="line"></span><br><span class="line">say()</span><br></pre></td></tr></table></figure>

<p><code>say</code>  因為沒有傳參數進去，所以是預設綁定，在非嚴格模式底下是  <code>window</code>  ，所以會  <code>window.value</code>  也就是 <code>undefined</code>  。</p>
<p>可以透過把 function 的呼叫轉成用 call 的形式，就會較容易看出 this 的值是什麼。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">obj.func2.say() <span class="comment">// obj.func2.say.call(obj.func2) =&gt; 2</span></span><br><span class="line">obj2.say() <span class="comment">// obj2.say.call(obj2) =&gt; 2</span></span><br><span class="line">say() <span class="comment">// say.call() =&gt; undefined</span></span><br></pre></td></tr></table></figure>

<h3 id="箭頭函式的-this"><a href="#箭頭函式的-this" class="headerlink" title="箭頭函式的 this"></a>箭頭函式的 this</h3><p>從 ES6 開始新增了一種叫做 「箭頭函式表示式」 (Arrow Function expression) 的函式表達式。</p>
<p>而箭頭函式有兩個重要的特性：</p>
<ul>
<li>更簡短的函式寫法</li>
<li>this 變數強制綁定</li>
</ul>
<p>ES6 新增的箭頭函式中的 <code>this</code> 有不一樣的運作方式，只要記住「在宣告它的地方的 this 是什麼，它的 this 就是什麼」，什麼意思呢？讓我們看個範例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  Firstname: <span class="string">"Vincent"</span>,</span><br><span class="line"></span><br><span class="line">  say: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 這邊印出來的 this 是什麼，func1 的 this 就會是什麼</span></span><br><span class="line">    <span class="comment">// 在宣告它的地方的 this 是什麼，func1 的 this 就是什麼</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)     </span><br><span class="line">    <span class="keyword">const</span> func1 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.Firstname)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    func1()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.say() </span><br><span class="line"><span class="comment">// &#123;Firstname: "Vincent", say: ƒ&#125;</span></span><br><span class="line"><span class="comment">// Vincent</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> say = obj.say</span><br><span class="line"></span><br><span class="line">say() </span><br><span class="line"><span class="comment">// Window</span></span><br><span class="line"><span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<p>我們在 <code>say</code>  這個 function 裡面宣告了  <code>func1</code>  這個箭頭函式，所以 <code>say</code>  的 this 是什麼， <code>func1</code>  的 this 就會是什麼。</p>
<p>箭頭函式的 this 不是取決於在宣告時那個地方的 this。</p>
<h3 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h3><ol>
<li><p><a href="https://blog.techbridge.cc/2019/02/23/javascript-this/" target="_blank" rel="noopener">https://blog.techbridge.cc/2019/02/23/javascript-this/</a></p>
</li>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10193193" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10193193</a></p>
</li>
<li><p><a href="https://wcc723.github.io/javascript/2017/12/12/javascript-this/" target="_blank" rel="noopener">https://wcc723.github.io/javascript/2017/12/12/javascript-this/</a></p>
</li>
</ol>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-2019-11-16-JavaScript-15"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="../../2019/11/17/2019-11-16-JavaScript-15/">JavaScript Closure</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="../../2019/11/17/2019-11-16-JavaScript-15/" class="article-date">
	  <time datetime="2019-11-16T16:00:00.000Z" itemprop="datePublished">十一月 17, 2019</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="logo.svg" style="width:15%;">

<br/>

<h2 id="Scope-Chain"><a href="#Scope-Chain" class="headerlink" title="Scope Chain"></a>Scope Chain</h2><p>在開始談閉包之前，我們現來談談「範圍鏈」(Scope Chain) 的觀念。</p>
<p>Scope Chain(範圍鏈)的特性，是指使用變數的時候，會遵循著 Scope Chain 一層一層往外找，也就是看看函式自身的 context 物件上是否有該特性，如果沒有就往外頭的 context 物件看看有沒有該特性。</p>
<p>用 var 所宣告的變數，作用範圍是在當時所在環境(函式內)，而不使用 var 直接指定值而建立的變數，則是全域物件(window)上的一個屬性，也就全域範圍。</p>
<p>例如像下面這段程式碼：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myVar = <span class="string">"outer"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(myVar); <span class="comment">// outer</span></span><br><span class="line">  myVar = <span class="string">"inner"</span>;</span><br><span class="line">&#125;</span><br><span class="line">func();</span><br><span class="line"><span class="built_in">console</span>.log(myVar); <span class="comment">// inner</span></span><br></pre></td></tr></table></figure>

<p><code>func</code> 的變數<code>myVar</code> 因為沒有使用 <code>var</code> 進行宣告，所以 <code>myVar</code>  會變成「全域變數」。</p>
<p>修改一下上面範例，若是在<code>func</code> 中的 <code>myVar</code>，有透過 <code>var</code> 宣告時，變數就會作用在當時的環境，也就是 <code>func</code> 。</p>
<p>由於 JavaScript 提升 (Hoisting)的特性，Hoisting 是 JavaScript 的預設行為，<strong>把所有宣告效果提到當前 Scope 的頂端</strong>，也就是變數可以在宣告之前進行初始化和使用，而不會拋錯：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myVar = <span class="string">"outer"</span>;</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(myVar); <span class="comment">// undefined</span></span><br><span class="line"> <span class="keyword">var</span> myVar = <span class="string">"inner"</span>;</span><br><span class="line">&#125;</span><br><span class="line">func();</span><br><span class="line"><span class="built_in">console</span>.log(myVar); <span class="comment">// outer</span></span><br></pre></td></tr></table></figure>

<p><code>func</code> 運作上等同於：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> <span class="keyword">var</span> myVar;</span><br><span class="line"> <span class="built_in">console</span>.log(myVar);<span class="comment">// undefined</span></span><br><span class="line"> myVar = <span class="string">"inner"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>讓我們在看一個例子，每一個 function 執行的時候都會建立一個新的 context，所以 <code>func</code> 和  <code>fund</code>  各自為獨立的一個 Function execution context(執行環境)：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myVar = <span class="string">"outer"</span>;</span><br><span class="line"><span class="comment">//另外一個執行環境</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(myVar); <span class="comment">// outer</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//一個執行環境</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fund</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> myVar = <span class="string">"inner"</span>;</span><br><span class="line">  func();</span><br><span class="line">&#125;</span><br><span class="line">fund();</span><br></pre></td></tr></table></figure>

<p>當 <code>fund</code> 呼叫 <code>func</code> 時，由於 <code>fund</code> 和 <code>func</code> 都處於全域的環境，而 <code>myVar</code> 變數是被定義在 <code>fund</code> 的函式裡面；當你試圖在 <code>func</code> 中 使用 <code>myVar</code> 變數時，它會查看 <code>func</code> 的 context 物件上是否有該特性，如果有就使用，沒有就往外面一層找。由於 <code>func</code> 的上一層是 global context ，所以就存取到全域變數的 <code>myVar</code>，最終印出的結果就會是 <code>outer</code> 。</p>
<br/>

<p>如果函式 <code>func</code>  的位置是被 <code>fund</code>  所包裹，當 <code>func</code> 找不到  <code>myVar</code> ，就會往它的向外一層找；所以就存取到 <code>fund</code>  裡面的 <code>myVar</code>  ，輸出  <code>inner</code>  。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myVar = <span class="string">"outer"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fund</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> myVar = <span class="string">"inner"</span>;</span><br><span class="line">  func();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="built_in">console</span>.log(myVar); <span class="comment">// inner</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">fund();</span><br></pre></td></tr></table></figure>

<h2 id="閉包-Closure"><a href="#閉包-Closure" class="headerlink" title="閉包 Closure"></a>閉包 Closure</h2><p>閉包是個特殊的物件，他包含了一個函式，以及函式被建立時所在的環境。</p>
<p>在 JavaScript 中，只要有巢狀的函數定義，就會形成閉包。因為內層的函數需要引用到外層函數中定義的變數（建立範圍鏈 Scope Chain），所以外層函數中變數的狀態就好像被內層函數「關閉」起來了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">OuterFunction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 一個局部變數</span></span><br><span class="line">    <span class="keyword">var</span> outerVariable = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">InnerFunction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 內部函數可以存取外部函式的變數</span></span><br><span class="line"></span><br><span class="line">        alert(outerVariable);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回一個內部函式，並創建一個 closure  </span></span><br><span class="line">    <span class="keyword">return</span> InnerFunction;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> innerFunc = OuterFunction();</span><br><span class="line"></span><br><span class="line">innerFunc(); <span class="comment">// 100</span></span><br></pre></td></tr></table></figure>

<p>上面例子中，<code>OuterFunction()</code> 執行時返回一個 function，同時自動創建了一個 closure 環境。closure 像是一個特殊的物件 (指定給了 <code>innerFunc</code>  )，closure 中包含一個函數  <code>InnerFunction</code>  ，以及函數 <code>OuterFunction</code>  執行當時的環境，讓你在函數返回後還是可以持續存取 closure 保存的環境 ，像是能存取  <code>outerVariable</code>  變數， <code>outerVariable</code>  變數不會因為函數返回後而被刪除。</p>
<br/>

<p>在這個例子中，我們把 <code>counter</code> 封裝在 <code>Counter()</code> 當中，不但可以讓裡面的 <code>counter</code> 不會暴露在 global 環境造成變數衝突，也可以確保內部 <code>counter</code> 被修改：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">IncreaseCounter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> counter += <span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> IncreaseCounter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> counter = Counter();</span><br><span class="line">alert(counter()); <span class="comment">// 1</span></span><br><span class="line">alert(counter()); <span class="comment">// 2</span></span><br><span class="line">alert(counter()); <span class="comment">// 3</span></span><br><span class="line">alert(counter()); <span class="comment">// 4</span></span><br></pre></td></tr></table></figure>

<p>如果我們需要新增另一個計數器的話，透過一個閉包可以很輕鬆地達成：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Counter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">function</span> <span class="title">IncreaseCounter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> counter += <span class="number">1</span>;</span><br><span class="line">     &#125;;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> IncreaseCounter;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">var</span> counter = Counter();</span><br><span class="line"> <span class="keyword">var</span> counter2 = Counter();</span><br><span class="line"></span><br><span class="line"> alert(counter()); <span class="comment">// 1</span></span><br><span class="line"> alert(counter()); <span class="comment">// 2</span></span><br><span class="line"> alert(counter()); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"> alert(counter2()); <span class="comment">// 1</span></span><br><span class="line"> alert(counter2()); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<p><code>counter</code> 與 <code>counter2</code> 各自是「獨立」的計數器實體，彼此不會互相干擾。</p>
<h3 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h3><ol>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10193009" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10193009</a></p>
</li>
<li><p><a href="https://www.fooish.com/javascript/function-closure.html" target="_blank" rel="noopener">https://www.fooish.com/javascript/function-closure.html</a></p>
</li>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10029457" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10029457</a></p>
</li>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10199934" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10199934</a></p>
</li>
<li><p><a href="https://www.tutorialsteacher.com/javascript/closure-in-javascript" target="_blank" rel="noopener">https://www.tutorialsteacher.com/javascript/closure-in-javascript</a></p>
</li>
</ol>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-2019-11-16-JavaScript-13"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="../../2019/11/16/2019-11-16-JavaScript-13/">JavaScript IIFEs</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="../../2019/11/16/2019-11-16-JavaScript-13/" class="article-date">
	  <time datetime="2019-11-15T16:00:00.000Z" itemprop="datePublished">十一月 16, 2019</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="logo.svg" style="width:15%;">

<br/>

<br/>

<br/>

<h2 id="IIFEs"><a href="#IIFEs" class="headerlink" title="IIFEs"></a>IIFEs</h2><p><strong>立即被呼叫的函式 (Immediately Invoked Function Expression, IIFE)</strong>，</p>
<p>Immediately 是立即的意思，invoked 則是執行某個函式時，「執行」的意思，function expression 是一種用來建立 function 的方法，<strong>總括來說，就是用 function expression 的方式建立函式後並立即執行它</strong>。</p>
<h3 id="Function-Statement-和-Function-Expression"><a href="#Function-Statement-和-Function-Expression" class="headerlink" title="Function Statement 和 Function Expression"></a>Function Statement 和 Function Expression</h3><p>以下為 Function Statement 和 Function Expression 的範例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function statement</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(num);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">fn1(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// function expression</span></span><br><span class="line"><span class="keyword">var</span> fn2= <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(num);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">fn2(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>先來看一下範例，印出 <code>fn1()</code>  的內容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function expression</span></span><br><span class="line"><span class="keyword">var</span> fn1 = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(fn1);</span><br></pre></td></tr></table></figure>

<p>呼叫 <code>fn1()</code> 後，它會回傳整個函式的內容，這是尚未 <strong>執行（Invoked）</strong>的結果。</p>
<img src="2019-11-16-JavaScript-13-1.PNG" >

<br/>

<p>如果是 IIFEs 就在這段程式碼的最後，加上一個執行的指令，也就是括號 ( )：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn1 = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(num);</span><br><span class="line">&#125;(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p>在我們建立函式的同時，這段函式就會立即被執行了，印出 <code>10</code> 。</p>
<h3 id="試著把-function-裡面的-console-log-改成-return"><a href="#試著把-function-裡面的-console-log-改成-return" class="headerlink" title="試著把 function 裡面的 console.log 改成 return"></a>試著把 function 裡面的 console.log 改成 return</h3><p>原本 <strong>function expression</strong> 的程式碼如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function expression</span></span><br><span class="line"><span class="keyword">var</span> fn1 = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span>(num);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(fn1);</span><br></pre></td></tr></table></figure>

<p>可以發現結果還是一個函式：</p>
<p><img src="2019-11-16-JavaScript-13-2.PNG" ><br/></p>
<p>如果把它改成 <strong>IIFEs</strong> 的話，就會得到 <code>10</code> ：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Immediately Invoked Functions Expressions (IIFEs)</span></span><br><span class="line"><span class="keyword">var</span> fn1 = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span>(num);</span><br><span class="line">&#125;(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(fn1);</span><br></pre></td></tr></table></figure>

<p>在利用 IIFE 的寫法後，原本的變數 fn1 已經變成函式執行後回傳的「Number」，它已經是數字而不是 function ，如果還使用 () 去 Invoke(執行) 的話會出現錯誤。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Immediately Invoked Functions Expressions (IIFEs)</span></span><br><span class="line"><span class="keyword">var</span> fn1 = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span>(num);</span><br><span class="line">&#125;(<span class="number">10</span>);</span><br><span class="line"><span class="built_in">console</span>.log(fn1());</span><br></pre></td></tr></table></figure>

<p>產生錯誤：</p>
<p><img src="2019-11-16-JavaScript-13-3.PNG" ><br/></p>
<p>下面的範例，我們建立了一個匿名函式，並且透過 IIFEs 馬上執行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value= <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value= <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(value)</span><br><span class="line">  <span class="built_in">console</span>.log(num);</span><br><span class="line">&#125;)(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(value);</span><br></pre></td></tr></table></figure>

<p>以下為執行結果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>由執行結果可看到，在IIFEs中所建立的變數，不會影響到 Global Execution Context 所建立的變數，也就是說，透過IIFEs，達成不同 execution context 的變數之間不會互相影響。</p>
<p>不過我們可以透過填入物件 window  ，直接針對 window 裡面的物件去做改變：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value= <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">global,num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value= <span class="number">3</span>;</span><br><span class="line">    <span class="comment">//透過 global 去修改外面的 value </span></span><br><span class="line">    global.value=<span class="number">4</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">    <span class="built_in">console</span>.log(num);</span><br><span class="line">&#125;)(<span class="built_in">window</span>,<span class="number">2</span>);<span class="comment">// 新增一個參數 window</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(value);</span><br></pre></td></tr></table></figure>

<p>結果如下，成功變更在 Global Execution Context 的 <code>value</code> 為 <code>4</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">2</span><br><span class="line">4</span><br></pre></td></tr></table></figure>

<h3 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h3><ol>
<li><p><a href="https://pjchender.blogspot.com/2016/05/javascriptiifesimmediately-invoked.html" target="_blank" rel="noopener">https://pjchender.blogspot.com/2016/05/javascriptiifesimmediately-invoked.html</a></p>
</li>
<li><p><a href="https://pjchender.blogspot.com/2016/05/iifesimmediately-invoked-functions.html" target="_blank" rel="noopener">https://pjchender.blogspot.com/2016/05/iifesimmediately-invoked-functions.html</a></p>
</li>
<li><p><a href="https://dotblogs.com.tw/h20/2019/03/06/162305" target="_blank" rel="noopener">https://dotblogs.com.tw/h20/2019/03/06/162305</a></p>
</li>
</ol>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-2019-11-16-JavaScript-14"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="../../2019/11/16/2019-11-16-JavaScript-14/">JavaScript Callback Function</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="../../2019/11/16/2019-11-16-JavaScript-14/" class="article-date">
	  <time datetime="2019-11-15T16:00:00.000Z" itemprop="datePublished">十一月 16, 2019</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="logo.svg" style="width:15%;">

<br/>

<h2 id="Callback-Function"><a href="#Callback-Function" class="headerlink" title="Callback Function"></a>Callback Function</h2><p><strong>把函式當作另一個函式的參數，透過另一個函式來呼叫它</strong>，他可以「<strong>控制多個函式間執行的順序</strong>」。</p>
<p>來看個例子，首先定義兩個 <code>function</code> ，因為 <code>function</code> 會立即執行，所以先印出 <code>1</code> ，在印出 <code>2</code> ：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">first</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">second</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">first();<span class="comment">//1</span></span><br><span class="line"></span><br><span class="line">second();<span class="comment">//2</span></span><br></pre></td></tr></table></figure>

<p>透過 <code>setTimeout</code> 讓 <code>first()</code>  設定延遲 500毫秒 在執行， JavaScript 不會等待 <code>first()</code> 執行完才執行 <code>second()</code> ；所以就算我們先呼叫了 <code>first()</code> ，也會是 <code>second()</code> 先被執行，結果就會是先印出 <code>2</code> ，在印出 <code>1</code> ：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">first</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">// Simulate a code delay</span></span><br><span class="line">  setTimeout( <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">500</span> );</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">second</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">first();</span><br><span class="line"></span><br><span class="line">second();</span><br><span class="line"><span class="comment">//2</span></span><br><span class="line"><span class="comment">//1</span></span><br></pre></td></tr></table></figure>

<p>像這種時候，為了確保執行的順序，就會透過 Callback function 的形式來處理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 為了確保先執行 first 再執行 second</span></span><br><span class="line"><span class="comment">// 我們在 first 加上 callback 參數</span></span><br><span class="line"><span class="keyword">var</span> first=<span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    callback();</span><br><span class="line">  &#125;, <span class="number">500</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> second=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 將 second 作為參數帶入 first()</span></span><br><span class="line">first(second);</span><br><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="comment">//2</span></span><br></pre></td></tr></table></figure>

<p>像這樣，無論 <code>first</code> 在執行的時候要等多久， <code>second</code> 都會等到 <code>console.log(1);</code> 之後才執行。</p>
<p>另一個例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doHomework</span>(<span class="params">subject, callback</span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">`Starting my <span class="subst">$&#123;subject&#125;</span> homework.`</span>);</span><br><span class="line">  callback();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">alertFinished</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  alert(<span class="string">'Finished my homework'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doHomework(<span class="string">'math'</span>, alertFinished);</span><br><span class="line"><span class="comment">//Starting my math homework.</span></span><br><span class="line"><span class="comment">//Finished my homework</span></span><br></pre></td></tr></table></figure>

<p>不過需要注意的是，當函式之間的相依過深，callback 多層之後產生的「Callback Hell」維護起來就會很複雜。</p>
<br/>

<img src="2019-11-16-JavaScript-14-1.jpg" style="width:80%;">

<br/>

<h3 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h3><ol>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10192739" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10192739</a></p>
</li>
<li><p><a href="https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced" target="_blank" rel="noopener">https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced</a></p>
</li>
</ol>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-2019-11-14-JavaScript-12"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="../../2019/11/15/2019-11-14-JavaScript-12/">DOM - 事件處裡及傳遞機制</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="../../2019/11/15/2019-11-14-JavaScript-12/" class="article-date">
	  <time datetime="2019-11-14T16:00:00.000Z" itemprop="datePublished">十一月 15, 2019</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="logo.svg" style="width:15%;">

<br/>

<br/>

<br/>

<h5 id="這篇教學介紹瀏覽器事件的運作原理，包含-EventTarget-、-Event-Bubbling-、-Event-Capturing-、-Event-Delegation-。"><a href="#這篇教學介紹瀏覽器事件的運作原理，包含-EventTarget-、-Event-Bubbling-、-Event-Capturing-、-Event-Delegation-。" class="headerlink" title="這篇教學介紹瀏覽器事件的運作原理，包含 EventTarget 、 Event Bubbling 、 Event Capturing 、 Event Delegation 。"></a>這篇教學介紹瀏覽器事件的運作原理，包含 EventTarget 、 Event Bubbling 、 Event Capturing 、 Event Delegation 。</h5><br/>

<h2 id="Event-Flow"><a href="#Event-Flow" class="headerlink" title="Event Flow"></a>Event Flow</h2><p>事件流程 (Event Flow) 指的就是「<strong>網頁元素接收事件的順序</strong>」。</p>
<p>事件流程可以分成兩種機制：</p>
<ul>
<li>事件冒泡 (Event Bubbling)</li>
<li>事件捕獲 (Event Capturing)</li>
</ul>
<br/>

<h2 id="事件冒泡-Event-Bubbling"><a href="#事件冒泡-Event-Bubbling" class="headerlink" title="事件冒泡 (Event Bubbling)"></a>事件冒泡 (Event Bubbling)</h2><p>Event Bubbling 指的是當某個事件發生在某個 DOM element 上（如：點擊），這個事件會觸發 DOM element 的 event handler ，接下來會再觸發他的 parent 的 event handler ，以及 parent 的 parent 的 event handler …直到最上層。</p>
<img src="2019-11-14-JavaScript-12-1.png" style="width:50%;">

<br/>

<p>圖片來源： <a href="http://www.java2s.com/Book/JavaScript/DOM/Event_Flow_capture_target_and_bubbling.htm" target="_blank" rel="noopener">Event Flow: capture, target, and bubbling</a></p>
<br/>

<p>事件冒泡指的是「從啟動事件的元素節點開始，逐層往上傳遞」，直到整個網頁的根節點，也就是 <code>document</code>。</p>
<h2 id="事件捕獲-Event-Capturing"><a href="#事件捕獲-Event-Capturing" class="headerlink" title="事件捕獲 (Event Capturing)"></a>事件捕獲 (Event Capturing)</h2><p>和 Event Bubbling 相反， event 發生在某個 DOM element 上的時候，會從他的最上層 parent 開始觸發 event handler ，再來是倒數第二上層的 event handler ，以此類推，直到觸發事件的 DOM element 本身的 event handler 。</p>
<img src="2019-11-14-JavaScript-12-2.png" style="width:50%;">

<br/>

<p>圖片來源： <a href="http://www.java2s.com/Book/JavaScript/DOM/Event_Flow_capture_target_and_bubbling.htm" target="_blank" rel="noopener">Event Flow: capture, target, and bubbling</a></p>
<br/>

<p>事件捕獲則和事件冒泡機制相反。</p>
<br/>

<p>例如我們看這一個 HTML DOM 結構：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;event flow example&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;&lt;&#x2F;li&gt;</span><br><span class="line">        &lt;&#x2F;ul&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>當使用者點擊 li 元素時，事件觸發的順序是：</p>
<ol>
<li><p>Capturing 捕獲階段：<code>Document -&gt; &lt;html&gt; -&gt; &lt;body&gt; -&gt; &lt;div&gt; -&gt; &lt;ul&gt; -&gt; &lt;li&gt;</code></p>
<br/>
</li>
<li><p>Bubbling 氣泡階段：<code>&lt;li&gt; -&gt; &lt;ul&gt; -&gt; &lt;div&gt; -&gt; &lt;body&gt; -&gt; &lt;html&gt; -&gt; Document</code></p>
</li>
</ol>
<br/>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>要檢驗事件流程，我們可以透過 <code>addEventListener()</code> 方法來綁定 <code>click</code> 事件，透過 addEventListener 指定事件的綁定，第三個參數 true / false 分別代表捕獲/ 冒泡 機制，不加參數的話，預設值是 false：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;ul id=<span class="string">"list"</span>&gt;</span><br><span class="line">    &lt;li id=<span class="string">"list_item"</span>&gt;</span><br><span class="line">      &lt;a id=<span class="string">"list_item_link"</span> target=<span class="string">"_blank"</span> href=<span class="string">"https://cheng-yi-ting.github.io/"</span>&gt;</span><br><span class="line">        Click link!</span><br><span class="line">      &lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>li&gt;</span><br><span class="line">  &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"> &lt;script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">var list = document.getElementById('list');</span></span><br><span class="line"><span class="regexp">var list_item = document.getElementById('list_item');</span></span><br><span class="line"><span class="regexp">var list_item_link = document.getElementById('list_item_link');</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ list 的捕獲</span></span><br><span class="line"><span class="regexp">list.addEventListener('click', (e) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  console.log('list capturing', e.eventPhase);</span></span><br><span class="line"><span class="regexp">&#125;, true)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ list 的冒泡</span></span><br><span class="line"><span class="regexp">list.addEventListener('click', (e) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  console.log('list bubbling', e.eventPhase);</span></span><br><span class="line"><span class="regexp">&#125;, false)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ list_item 的捕獲</span></span><br><span class="line"><span class="regexp">list_item.addEventListener('click', (e) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  console.log('list_item capturing', e.eventPhase);</span></span><br><span class="line"><span class="regexp">&#125;, true)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ list_item 的冒泡</span></span><br><span class="line"><span class="regexp">list_item.addEventListener('click', (e) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  console.log('list_item bubbling', e.eventPhase);</span></span><br><span class="line"><span class="regexp">&#125;, false)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ list_item_link 的捕獲</span></span><br><span class="line"><span class="regexp">list_item_link.addEventListener('click', (e) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  console.log('list_item_link capturing', e.eventPhase);</span></span><br><span class="line"><span class="regexp">&#125;, true)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ list_item_link 的冒泡</span></span><br><span class="line"><span class="regexp">list_item_link.addEventListener('click', (e) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  console.log('list_item_link bubbling', e.eventPhase);</span></span><br><span class="line"><span class="regexp">&#125;, false)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"> &lt;/</span>script&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>

<p>點一下超連結，<code>console</code> 輸出以下結果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">list capturing 1</span><br><span class="line">list_item capturing 1</span><br><span class="line">list_item_link capturing 2</span><br><span class="line">list_item_link bubbling 2</span><br><span class="line">list_item bubbling 3</span><br><span class="line">list bubbling 3</span><br></pre></td></tr></table></figure>

<p>1 是<code>CAPTURING_PHASE</code>，2 是<code>AT_TARGET</code>，3 是<code>BUBBLING_PHASE</code>。</p>
<p>從這邊就可以很明顯看出，事件的確是從最上層一直傳遞到 target，再從 target 不斷冒泡傳回去，先傳到上一層的<code>#list_item</code>，再傳到上上層的<code>#list</code>。</p>
<p>事件傳遞到我們點擊的超連結（<code>a#list_item_link</code>）本身，在這邊無論你使用<code>addEventListener</code>的第三個參數是<code>true</code>還是<code>false</code>，這邊的<code>e.eventPhase</code>都會變成<code>AT_TARGET</code>。</p>
<h3 id="Capturing-或-Bubbling-的目標執行順序"><a href="#Capturing-或-Bubbling-的目標執行順序" class="headerlink" title="Capturing 或 Bubbling 的目標執行順序"></a>Capturing 或 Bubbling 的目標執行順序</h3><p>既然是先捕獲，再冒泡，意思就是無論那些<code>addEventListener</code>的順序怎麼變，輸出的東西應該還是會一樣才對。我們把捕獲跟冒泡的順序對調，看一下輸出結果是否一樣。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// list 的冒泡</span></span><br><span class="line">list.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'list bubbling'</span>, e.eventPhase);</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// list 的捕獲</span></span><br><span class="line">list.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'list capturing'</span>, e.eventPhase);</span><br><span class="line">&#125;, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// list_item 的冒泡</span></span><br><span class="line">list_item.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'list_item bubbling'</span>, e.eventPhase);</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// list_item 的捕獲</span></span><br><span class="line">list_item.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'list_item capturing'</span>, e.eventPhase);</span><br><span class="line">&#125;, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// list_item_link 的冒泡</span></span><br><span class="line">list_item_link.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'list_item_link bubbling'</span>, e.eventPhase);</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// list_item_link 的捕獲</span></span><br><span class="line">list_item_link.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'list_item_link capturing'</span>, e.eventPhase);</span><br><span class="line">&#125;, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>點一下超連結，<code>console</code> 輸出以下結果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">list capturing 1</span><br><span class="line">list_item capturing 1</span><br><span class="line">list_item_link bubbling 2</span><br><span class="line">list_item_link capturing 2</span><br><span class="line">list_item bubbling 3</span><br><span class="line">list bubbling 3</span><br></pre></td></tr></table></figure>

<p><code>list_item_link</code>先執行了添加在冒泡階段的 listener，才執行捕獲階段的 listener。</p>
<p>前面有提到，當事件傳遞到點擊的真正對象，也就是 e.target 的時候，無論<code>addEventListener</code>的第三個參數是<code>true</code>還是<code>false</code>，這邊的<code>e.eventPhase</code>都會變成<code>AT_TARGET</code>。</p>
<p>既然已經是<code>AT_TARGET</code>，就不會區分捕獲跟冒泡，執行順序會根據<code>addEventListener</code>的順序來決定，先添加的先執行，後添加的後執行。</p>
<br/>

<h3 id="關於這些事件的傳遞順序，只需記住兩個原則："><a href="#關於這些事件的傳遞順序，只需記住兩個原則：" class="headerlink" title="關於這些事件的傳遞順序，只需記住兩個原則："></a>關於這些事件的傳遞順序，只需記住兩個原則：</h3><ul>
<li><strong>先捕獲，再冒泡</strong></li>
<li><strong>當事件傳到 target 本身，沒有分捕獲跟冒泡</strong></li>
</ul>
<br/>

<h2 id="阻擋事件冒泡傳遞-event-stopPropagation"><a href="#阻擋事件冒泡傳遞-event-stopPropagation" class="headerlink" title="阻擋事件冒泡傳遞 event.stopPropagation()"></a>阻擋事件冒泡傳遞 event.stopPropagation()</h2><p>如果我們想要阻擋事件向上冒泡傳遞，那麼就可以利用 event object 提供的另一個方法：  <code>event.stopPropagation()</code>  ，讓事件的傳遞中斷，不會繼續往下傳遞。</p>
<p>根據上面的例子，我添加 <code>event.stopPropagation()</code>  至 <code>#list</code> 的捕獲階段：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// list 的捕獲</span></span><br><span class="line">list.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'list capturing'</span>, e.eventPhase);</span><br><span class="line">  e.stopPropagation();</span><br><span class="line">&#125;, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>點一下超連結，<code>console</code> 輸出以下結果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list capturing 1</span><br></pre></td></tr></table></figure>

<p>因為事件的傳遞被停止，所以剩下的 listener 都不會再收到任何事件。</p>
<p><strong>如果在同一個節點上不只一個 listener，其他 listener 還是會被執行。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// list 的捕獲 A</span></span><br><span class="line">list.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'list capturing-A'</span>);</span><br><span class="line">  e.stopPropagation();</span><br><span class="line">&#125;, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// list 的捕獲 B</span></span><br><span class="line">list.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'list capturing-B'</span>);</span><br><span class="line">&#125;, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>點一下超連結，<code>console</code> 輸出以下結果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list capturing-A</span><br><span class="line">list capturing-B</span><br></pre></td></tr></table></figure>

<p>如果要讓其他同一層級的 listener 也不要被執行，可以使用  <code>e.stopImmediatePropagation()</code>  ：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// list 的捕獲 A</span></span><br><span class="line">list.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'list capturing-A'</span>);</span><br><span class="line">  e.stopImmediatePropagation();</span><br><span class="line">&#125;, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// list 的捕獲 B</span></span><br><span class="line">list.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'list capturing-B'</span>);</span><br><span class="line">&#125;, <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p>點一下超連結，<code>console</code> 輸出以下結果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list capturing-A</span><br></pre></td></tr></table></figure>

<h2 id="阻擋預設行為-event-preventDefault"><a href="#阻擋預設行為-event-preventDefault" class="headerlink" title="阻擋預設行為 event.preventDefault()"></a>阻擋預設行為 event.preventDefault()</h2><p>HTML 部分元素會有預設行為，像是 <code>&lt;a&gt;</code> 的連結，或是表單的 <code>submit</code> 等等…，<br>如果我們需要在這些元素上綁定事件，那麼可以透過 <code>event.preventDefault()</code> 來<strong>取消它們的預設行為</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// list_item_link 的冒泡</span></span><br><span class="line">list_item_link.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<p>當點擊超連結的時候，就不會執行原本預設的行為（新開分頁）。<code>event.preventDefault()</code>在之後傳遞下去的事件裡面也會有效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; list 的捕獲 A</span><br><span class="line">list.addEventListener(&#39;click&#39;, (e) &#x3D;&gt; &#123;</span><br><span class="line">  console.log(&#39;list capturing-A&#39;);</span><br><span class="line">  e.preventDefault();</span><br><span class="line"> &#125;, true)</span><br></pre></td></tr></table></figure>

<p>就算是把 <code>event.preventDefault()</code>  添加到 <code>#list</code>  的捕獲事件裡面，等之後事件傳遞到<code>#list_item_link</code>的時候，一樣可以取消超連結的預設行為（新開分頁）。</p>
<h3 id="事件委派（Event-Delegation）"><a href="#事件委派（Event-Delegation）" class="headerlink" title="事件委派（Event Delegation）"></a>事件委派（Event Delegation）</h3><p>假設同時有很多 DOM element 都有相同的 event handler ，與其在每個 DOM element 上個別附加 event handler ，不如利用 event bubbling 的特性，統一在他們的 ancestor 的 event handler 處理，可以有效地減少監聽器數量。</p>
<p>假設有一個三個 <code>li</code>  節點的 <code>ul</code>  ，接著動態產生剩下的節點資料：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul id&#x3D;&quot;list&quot;&gt;</span><br><span class="line"> &lt;li &gt;one&lt;&#x2F;li&gt;</span><br><span class="line"> &lt;li &gt;two&lt;&#x2F;li&gt;</span><br><span class="line"> &lt;li &gt;three&lt;&#x2F;li&gt;</span><br><span class="line">&lt;ul&gt;</span><br></pre></td></tr></table></figure>

<p>雖然可以對個別的<code>li</code>附加 click event hander ，但有幾個<code>li</code>就要加幾次 <code>addEventListener</code>。我們可以透過 event delegation 的方式統一管理，任何點擊 <code>li</code> 的事件都傳到 <code>ul</code> ，因此我們可以在 <code>ul</code> 身上放一個 <code>addEventListener</code>。</p>
<p>以下例子為將點擊的 <code>li</code> 元素，設置 <code>hidden</code> 屬性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> list = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>);</span><br><span class="line"> list.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//點擊元素後，該元素隱藏</span></span><br><span class="line"> e.target.style.visibility = <span class="string">'hidden'</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// e.target refers to the clicked &lt;li&gt; element</span></span><br><span class="line"> <span class="comment">// This is different than e.currentTarget which would refer to the     parent &lt;ul&gt; in this context</span></span><br><span class="line"> <span class="built_in">console</span>.log(e.target.tagName);<span class="comment">//LI</span></span><br><span class="line"> <span class="built_in">console</span>.log(e.currentTarget.tagName);<span class="comment">//UL</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//this 代表的會是「觸發事件的目標」元素，也就是 event.currentTarget 而不是 e.target。</span></span><br><span class="line"> <span class="built_in">console</span>.log(<span class="keyword">this</span>.tagName);<span class="comment">//UL</span></span><br><span class="line"></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 取得 #list ul</span></span><br><span class="line"><span class="keyword">var</span> List = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>);</span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line"> <span class="comment">// 建立 li 標籤</span></span><br><span class="line"> <span class="keyword">var</span> node = <span class="built_in">document</span>.createElement(<span class="string">"LI"</span>);</span><br><span class="line"> <span class="comment">// 建立 文字節點</span></span><br><span class="line"> <span class="keyword">var</span> textnode = <span class="built_in">document</span>.createTextNode(i);</span><br><span class="line"> <span class="comment">// 透過 appendChild 將 文字節點 加入至 List</span></span><br><span class="line"> node.appendChild(textnode);</span><br><span class="line"> <span class="built_in">document</span>.getElementById(<span class="string">"list"</span>).appendChild(node);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>輸出結果：</p>
<li >one</li>
 <li >two</li>
 <li >three</li>
 <li >0</li>
 <li >1</li>
 <li >2</li>
 <li >3</li>
 <li >4</li>
 <li >5</li>
 <li >6</li>
 <li >7</li>
 <li >8</li>
 <li >9</li>

<br/>

<p>當新增或刪除一個 <code>li</code> 的時候，無需去處理和那個元素相關的 listener ，因為 listener 是放在  <code>ul</code>  ，透過父節點來處理子節點的事件，就稱為事件代理。</p>
<h3 id="E-CURRENTTARGET-VS-E-TARGET"><a href="#E-CURRENTTARGET-VS-E-TARGET" class="headerlink" title="E.CURRENTTARGET VS. E.TARGET"></a>E.CURRENTTARGET VS. E.TARGET</h3><p><code>event.currentTarget</code> 屬性會指向目前於冒泡或捕捉階段正在處理該事件之事件處理器所註冊的 DOM 物件，而 <code>event.target</code> 屬性則是會指向觸發事件的 DOM 物件。</p>
<p>如果放置一個 event listener 到 <code>p</code> 節點， <code>event.currentTarget</code> 就會指到 <code>p</code> ， <code>event.target</code> 則還是指到 <code>span</code> ，如果把 event listener 放置到 <code>body</code> 上，則 <code>event.currentTarget</code> 就會指到 <code>body</code> ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;p id&#x3D;&quot;list&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;a href&#x3D;&quot;#&quot;&gt;some </span><br><span class="line"></span><br><span class="line">        &lt;span&gt;text&lt;&#x2F;span&gt;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;a&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;p&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list = <span class="built_in">document</span>.getElementById(<span class="string">'list'</span>);</span><br><span class="line"></span><br><span class="line"> list.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(e.target.tagName);</span><br><span class="line"> <span class="built_in">console</span>.log(e.currentTarget.tagName);</span><br><span class="line"> &#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h3 id="EventTarget-addEventListener"><a href="#EventTarget-addEventListener" class="headerlink" title="EventTarget.addEventListener()"></a>EventTarget.addEventListener()</h3><p>addEventListener 方法可以用來綁定元素的事件處理函數，有三個參數，分別是「事件名稱」、「事件的處理器」(事件觸發時執行的 function)，以及一個「Boolean」值，由這個 Boolean 決定事件是以「捕獲」或「冒泡」機制執行，若不指定則預設為「冒泡」。</p>
<br/>
事件監聽範例：

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;table id&#x3D;&quot;outside&quot;&gt;</span><br><span class="line">    &lt;tr&gt;&lt;td id&#x3D;&quot;t1&quot;&gt;one&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;</span><br><span class="line">    &lt;tr&gt;&lt;td id&#x3D;&quot;t2&quot;&gt;two&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;</span><br><span class="line">&lt;&#x2F;table&gt;</span><br></pre></td></tr></table></figure>

<p><code>addEventListener</code> 可以對同一個元素指定多個事件處理函數，當點擊 <code>li</code> 元素時，跳出警告視窗，並執行 <code>modifyText</code> 函數；將 <code>t2</code> 的值 修改為 <code>four</code>  ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Function to change the content of t2</span><br><span class="line">function modifyText() &#123;</span><br><span class="line">  var t2 &#x3D; document.getElementById(&quot;t2&quot;);</span><br><span class="line">  t2.firstChild.nodeValue &#x3D; &quot;four&quot;;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; add event listener to table</span><br><span class="line">var el &#x3D; document.getElementById(&quot;outside&quot;);</span><br><span class="line">el.addEventListener(&quot;click&quot;, modifyText, false);</span><br><span class="line"></span><br><span class="line">el.addEventListener(&#39;click&#39;, function()&#123;</span><br><span class="line">  alert(&#39;HI&#39;);</span><br><span class="line">&#125;, false);</span><br></pre></td></tr></table></figure>

<p>可以修改為匿名函數的事件監聽：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">el.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;modifyText(<span class="string">"four"</span>)&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h3 id="EventTarget-removeEventListener"><a href="#EventTarget-removeEventListener" class="headerlink" title="EventTarget.removeEventListener()"></a>EventTarget.removeEventListener()</h3><p>取消透過 addEventListener 綁定的事件處理函數，三個參數與 <code>addEventListener()</code> 一樣，分別是「事件名稱」、「事件的處理器」以及「捕獲」或「冒泡」的機制。</p>
<p>但是需要注意的是，由於 <code>addEventListener()</code> 可以同時針對某個事件綁定多個 handler，所以透過 <code>removeEventListener()</code> 解除事件的時候，第二個參數的 handler 必須要與先前在 <code>addEventListener()</code> 綁定的 handler 是同一個「實體」。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var el &#x3D; document.getElementById(&quot;outside&quot;);</span><br><span class="line"></span><br><span class="line">el.addEventListener(&#39;click&#39;, function()&#123;alert(&#39;Hi&#39;);&#125;, false);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;remove event listener</span><br><span class="line">el.removeEventListener(&#39;click&#39;,function()&#123;alert(&#39;Hi&#39;);&#125;, false);</span><br></pre></td></tr></table></figure>

<p>即使執行了 <code>removeEventListener</code> 來移除事件，但 <code>click</code> 時仍會出現 ‘HI’。因為 <code>addEventListener</code> 與 <code>removeEventListener</code> 所移除的 handler 實際上是兩個不同實體的 function 物件。</p>
<p>需修改為以下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(<span class="string">"outside"</span>);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 把 event handler 先存到變數</span></span><br><span class="line"> <span class="keyword">var</span> clickHandler =<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     alert(<span class="string">'Hi'</span>);</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"> el.addEventListener(<span class="string">'click'</span>, clickHandler, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">//成功移除 clickHandler</span></span><br><span class="line"> el.removeEventListener(<span class="string">'click'</span>,clickHandler, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h3 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h3><ol>
<li><p><a href="https://blog.techbridge.cc/2017/07/15/javascript-event-propagation/" target="_blank" rel="noopener">https://blog.techbridge.cc/2017/07/15/javascript-event-propagation/</a></p>
</li>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10191970" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10191970</a></p>
</li>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10192015" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10192015</a></p>
</li>
<li><p><a href="http://shubo.io/event-bubbling-event-capturing-event-delegation/" target="_blank" rel="noopener">http://shubo.io/event-bubbling-event-capturing-event-delegation/</a></p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-TW/docs/Web/API/EventTarget/addEventListener" target="_blank" rel="noopener">https://developer.mozilla.org/zh-TW/docs/Web/API/EventTarget/addEventListener</a></p>
</li>
<li><p><a href="https://developer.mozilla.org/zh-TW/docs/Web/API/Event/target" target="_blank" rel="noopener">https://developer.mozilla.org/zh-TW/docs/Web/API/Event/target</a></p>
</li>
<li><p><a href="http://www.qc4blog.com/?p=650" target="_blank" rel="noopener">http://www.qc4blog.com/?p=650</a></p>
</li>
</ol>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/HTML/" rel="tag">HTML</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-2019-11-14-JavaScript-10"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="../../2019/11/14/2019-11-14-JavaScript-10/">JavaScript DOM 查找元素</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="../../2019/11/14/2019-11-14-JavaScript-10/" class="article-date">
	  <time datetime="2019-11-13T16:00:00.000Z" itemprop="datePublished">十一月 14, 2019</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="logo.svg" style="width:15%;">

<br/>

<p>DOM (Document Object Model) 定義了一組標準 API (Application Programming Interface) 讓我們可以用 JavaScript 對 HTML 文件做操作。</p>
<p>DOM 將一份 HTML 文件看作是一個樹狀結構的物件，讓我們可以方便直觀的存取樹中的節點 (node) 來改變其結構、樣式 (CSS) 或內容等。</p>
<p>document 物件是 DOM tree 的根節點，表示整份 HTML 文件，通常你要存取 HTML 都是從 document 物件開始：</p>
<br/>

<img src="2019-11-14-JavaScript-10-1.png" style="width:50%;">

<br/>

<p>圖片來源： <a href="https://en.wikipedia.org/wiki/Document_Object_Model" target="_blank" rel="noopener">Wikipedia DOM</a></p>
<br/>

<p>HTML DOM 規範中定義了這些類型的 API：</p>
<ul>
<li>讓我們可以對 HTML 的元素 (element) 當作是 JavaScript 物件 (object) 來操作</li>
<li>定義了 HTML 元素有哪些屬性 (properties) 可以來做存取</li>
<li>定義了 HTML 元素有哪些方法 (methods) 可以來被操作</li>
<li>定義了 HTML 元素事件 (events)，讓我們可以針對特定元素來綁定事件處理函式 (例如使用者按下滑鼠、在鍵盤打字都是所謂的事件)</li>
</ul>
<h3 id="document-getElementById-id"><a href="#document-getElementById-id" class="headerlink" title="document.getElementById(id)"></a>document.getElementById(id)</h3><p>透過 id 取得一個 HTML 元素。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;p id&#x3D;&quot;demo&quot;&gt;Click the button to change the text in this paragraph.&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;button onclick&#x3D;&quot;myFunction()&quot;&gt;Try it&lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">function myFunction() &#123;</span><br><span class="line">  document.getElementById(&quot;demo&quot;).innerHTML &#x3D; &quot;Hello World&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="document-getElementsByTagName-name"><a href="#document-getElementsByTagName-name" class="headerlink" title="document.getElementsByTagName(name)"></a>document.getElementsByTagName(name)</h3><p>用來根據 HTML 標籤 (tag) 名稱取得所有這個標籤的元素集合 (HTMLCollection)，返回的結果是一個像陣列 (array) 的物件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;An unordered list:&lt;&#x2F;p&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;li&gt;Coffee&lt;&#x2F;li&gt;</span><br><span class="line">  &lt;li&gt;Tea&lt;&#x2F;li&gt;</span><br><span class="line">  &lt;li&gt;Milk&lt;&#x2F;li&gt;</span><br><span class="line">&lt;&#x2F;ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;Click the button to display the innerHTML of the second li element (index 1).&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;button onclick&#x3D;&quot;myFunction()&quot;&gt;Try it&lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">&lt;p id&#x3D;&quot;demo&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">function myFunction() &#123;</span><br><span class="line">  var x &#x3D; document.getElementsByTagName(&quot;LI&quot;);</span><br><span class="line">  document.getElementById(&quot;demo&quot;).innerHTML &#x3D; x[1].innerHTML;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="document-getElementsByName-name"><a href="#document-getElementsByName-name" class="headerlink" title="document.getElementsByName(name)"></a>document.getElementsByName(name)</h3><p>用來取得特定名稱 (name) 的 HTML 元素集合 (HTMLCollection)，返回的結果是一個像陣列 (array) 的物件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">First Name: &lt;input name&#x3D;&quot;fname&quot; type&#x3D;&quot;text&quot; value&#x3D;&quot;Michael&quot;&gt;&lt;br&gt;</span><br><span class="line">First Name: &lt;input name&#x3D;&quot;fname&quot; type&#x3D;&quot;text&quot; value&#x3D;&quot;Doug&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;Click the button to get the tag name of the first element in the document that has a name attribute with the value &quot;fname&quot;.&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;button onclick&#x3D;&quot;myFunction()&quot;&gt;Try it&lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">&lt;p id&#x3D;&quot;demo&quot;&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">function myFunction() &#123;</span><br><span class="line">  var x &#x3D; document.getElementsByName(&quot;fname&quot;)[0].tagName;</span><br><span class="line">  document.getElementById(&quot;demo&quot;).innerHTML &#x3D; x;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="document-getElementsByClassName-names"><a href="#document-getElementsByClassName-names" class="headerlink" title="document.getElementsByClassName(names)"></a>document.getElementsByClassName(names)</h3><p>用來取得特定類別名稱 (class name) 的 HTML 元素集合 (HTMLCollection)，返回的結果是一個像陣列 (array) 的物件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class&#x3D;&quot;example&quot;&gt;First div element with class&#x3D;&quot;example&quot;.&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class&#x3D;&quot;example&quot;&gt;Second div element with class&#x3D;&quot;example&quot;.&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;Click the button to change the text of the first div element with class&#x3D;&quot;example&quot; (index 0).&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;button onclick&#x3D;&quot;myFunction()&quot;&gt;Try it&lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;strong&gt;Note:&lt;&#x2F;strong&gt; The getElementsByClassName() method is not supported in Internet Explorer 8 and earlier versions.&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">function myFunction() &#123;</span><br><span class="line">  var x &#x3D; document.getElementsByClassName(&quot;example&quot;);</span><br><span class="line">  x[0].innerHTML &#x3D; &quot;Hello World!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>可以使用空白隔開多個 class name，元素必須有所有指定的 class name 才符合。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取得同時有 demo 和 test 兩個 class name 的所有元素</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementsByClassName(<span class="string">'demo test'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="document-querySelector-selectors"><a href="#document-querySelector-selectors" class="headerlink" title="document.querySelector(selectors)"></a>document.querySelector(selectors)</h3><p>使用 CSS 選擇器 (CSS selectors) 來尋找符合條件且第一個找到的 HTML 元素。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h2 class&#x3D;&quot;example&quot;&gt;A heading with class&#x3D;&quot;example&quot;&lt;&#x2F;h2&gt;</span><br><span class="line">&lt;p class&#x3D;&quot;example&quot;&gt;A paragraph with class&#x3D;&quot;example&quot;.&lt;&#x2F;p&gt; </span><br><span class="line"></span><br><span class="line">&lt;p&gt;Click the button to add a background color to the first element in the document with class&#x3D;&quot;example&quot;.&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;button onclick&#x3D;&quot;myFunction()&quot;&gt;Try it&lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">function myFunction() &#123;</span><br><span class="line">  document.querySelector(&quot;.example&quot;).style.backgroundColor &#x3D; &quot;red&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="document-querySelectorAll-selectors"><a href="#document-querySelectorAll-selectors" class="headerlink" title="document.querySelectorAll(selectors)"></a>document.querySelectorAll(selectors)</h3><p>使用 CSS 選擇器 (CSS selectors) 來尋找所有符合條件的 HTML 元素集合 (NodeList)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;h2 class&#x3D;&quot;example&quot;&gt;A heading with class&#x3D;&quot;example&quot;&lt;&#x2F;h2&gt;</span><br><span class="line">&lt;p class&#x3D;&quot;example&quot;&gt;A paragraph with class&#x3D;&quot;example&quot;.&lt;&#x2F;p&gt; </span><br><span class="line"></span><br><span class="line">&lt;p&gt;Click the button to add a background color all elements with class&#x3D;&quot;example&quot;.&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;button onclick&#x3D;&quot;myFunction()&quot;&gt;Try it&lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;strong&gt;Note:&lt;&#x2F;strong&gt; The querySelectorAll() method is not supported in Internet Explorer 8 and earlier versions.&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">function myFunction() &#123;</span><br><span class="line">  var x, i;</span><br><span class="line">  x &#x3D; document.querySelectorAll(&quot;.example&quot;);</span><br><span class="line">  for (i &#x3D; 0; i &lt; x.length; i++) &#123;</span><br><span class="line">    x[i].style.backgroundColor &#x3D; &quot;red&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="DOM-tree-節點間位置的相互關係"><a href="#DOM-tree-節點間位置的相互關係" class="headerlink" title="DOM tree 節點間位置的相互關係"></a>DOM tree 節點間位置的相互關係</h2><p>由於 DOM 節點有分層的概念，於是節點與節點之間的關係，我們大致上可以分成兩種：</p>
<ul>
<li><p><strong>父子關係</strong>：<br>除了 <code>document</code> 之外，每一個節點都會有個上層的節點，我們通常稱之為「父節點」 (Parent node)，而相對地，從屬於自己下層的節點，就會稱為「子節點」(Child node)。</p>
</li>
<li><p><strong>兄弟關係</strong>：有同一個「父節點」的節點，那麼他們彼此之間就是「兄弟節點」(Siblings node)。</p>
</li>
</ul>
<br/>

<img src="2019-11-14-JavaScript-10-2.png" style="width:70%;">

<br/>

<p>圖片來源：<a href="https://ithelp.ithome.com.tw/articles/10191765" target="_blank" rel="noopener">重新認識 JavaScript: Day 12 透過 DOM API 查找節點 - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天</a></p>
<h3 id="Node-childNodes"><a href="#Node-childNodes" class="headerlink" title="Node.childNodes"></a>Node.childNodes</h3><p>所有的 DOM 節點物件都有 childNodes 屬性 (read-only property)，可以用來取得該元素下的所有子元素集合 (NodeList)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var demo &#x3D; document.querySelector(&#39;#demo&#39;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 如果 node 內有子元素</span><br><span class="line">if( demo.hasChildNodes() ) &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 可以透過 demo.childNodes[n] (n 為數字索引) 取得對應的節點</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 注意，NodeList 物件內容為即時更新的集合</span><br><span class="line">    for (var i &#x3D; 0; i &lt; demo.childNodes[i].length; i++) &#123;</span><br><span class="line">      &#x2F;&#x2F; ...</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Node.childNodes</code> 回傳的可能會有這幾種：</p>
<ul>
<li>HTML 元素節點 (element nodes)</li>
<li>文字節點 (text nodes)，包含空白</li>
<li>註解節點 (comment nodes)</li>
</ul>
<h2 id="Node-children"><a href="#Node-children" class="headerlink" title="Node.children"></a>Node.children</h2><p>DOM 節點物件的 children 屬性和 childNodes 屬性類似，差異在於 childNodes 返回的子元素會包含文字節點 (text nodes) 和註解節點 (comment nodes)，children 屬性則只會返回 HTML 元素節點 (HTMLCollection)。</p>
<h3 id="Node-firstChild"><a href="#Node-firstChild" class="headerlink" title="Node.firstChild"></a>Node.firstChild</h3><p><code>Node.firstChild</code> 可以取得 <code>Node</code> 節點的<strong>第一個</strong>子節點，如果沒有子節點則回傳 <code>null</code>。</p>
<p>要注意的是，子節點包括「空白」節點，所以像下面範例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;</span><br><span class="line">  &lt;span&gt;span 1&lt;&#x2F;span&gt;</span><br><span class="line">  &lt;span&gt;span 2&lt;&#x2F;span&gt;</span><br><span class="line">  &lt;span&gt;span 3&lt;&#x2F;span&gt;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  var p &#x3D; document.querySelector(&#39;p&#39;);</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; tagName 屬性可以取得 node 的標籤名稱</span><br><span class="line">  console.log(p.firstChild.tagName);      &#x2F;&#x2F; undefined</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>因為拿到的是 <code>&lt;p&gt;</code> 與第一個 <code>&lt;span&gt;</code> 中間的「換行字元」，所以 <code>p.firstChild.tagName</code> 會得到 <code>undefined</code>。</p>
<p>另一個例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;p id&#x3D;&quot;demo&quot;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;span&gt;First span&lt;&#x2F;span&gt;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var p &#x3D; document.getElementById(&#39;demo&#39;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 會顯示 &quot;#text&quot;，因為第一個子元素是換行字元</span><br><span class="line"></span><br><span class="line">    alert(p.firstChild.nodeName);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>可以把第一個例子修改成以下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&lt;span&gt;span 1&lt;&#x2F;span&gt;&lt;span&gt;span 2&lt;&#x2F;span&gt;&lt;span&gt;span 3&lt;&#x2F;span&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  var p &#x3D; document.querySelector(&#39;p&#39;);</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; tagName 屬性可以取得 node 的標籤名稱</span><br><span class="line">  console.log(p.firstChild.tagName);      &#x2F;&#x2F; &quot;SPAN&quot;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>把中間的換行與空白移除，就會得到預期中的 <code>&quot;SPAN&quot;</code> 了。</p>
<p>第二個例子修改方式也一樣：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;p id&#x3D;&quot;demo&quot;&gt;&lt;span&gt;First span&lt;&#x2F;span&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var p &#x3D; document.getElementById(&#39;demo&#39;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 會顯示 &quot;SPAN&quot;</span><br><span class="line">    alert(p.firstChild.nodeName);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Node-lastChild"><a href="#Node-lastChild" class="headerlink" title="Node.lastChild"></a>Node.lastChild</h3><p><code>Node.lastChild</code> 可以取得 <code>Node</code> 節點的<strong>最後一個</strong>子節點，如果沒有子節點則回傳 <code>null</code>。</p>
<p>與 <code>Node.firstChild</code> 一樣的是，子節點包括「空白」節點：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;p id&#x3D;&quot;demo&quot;&gt;&lt;span&gt;First span&lt;&#x2F;span&gt;&lt;span&gt;Second span&lt;&#x2F;span&gt;&lt;span&gt;Last span&lt;&#x2F;span&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var p &#x3D; document.getElementById(&#39;demo&#39;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 會顯示 &quot;Last span&quot;</span><br><span class="line">    alert(p.lastChild.innerHTML);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Node-parentNode"><a href="#Node-parentNode" class="headerlink" title="Node.parentNode"></a>Node.parentNode</h3><p>透過 <code>Node.parentNode</code> 可以用來取得父元素，回傳值可能會是一個元素節點 (Element node)、根節點 (Document node) 或 DocumentFragment 節點。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;</span><br><span class="line">    &lt;span id&#x3D;&quot;demo&quot;&gt;my span&lt;&#x2F;span&gt;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var elem &#x3D; document.getElementById(&#39;demo&#39;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 會顯示 &quot;P&quot;</span><br><span class="line">    alert(elem.parentNode.nodeName);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Node-previousSibling"><a href="#Node-previousSibling" class="headerlink" title="Node.previousSibling"></a>Node.previousSibling</h3><p>透過 <code>Node.previousSibling</code> 可以取得同層之間的「前一個」節點，如果 node 已經是第一個節點，則回傳 <code>null</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;&lt;span id&#x3D;&quot;s1&quot;&gt;s1&lt;&#x2F;span&gt;&lt;span id&#x3D;&quot;s2&quot;&gt;s2&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    &#x2F;&#x2F; 會顯示 null</span><br><span class="line">    alert(document.getElementById(&#39;s1&#39;).previousSibling);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 會顯示 &quot;s1&quot;</span><br><span class="line">    alert(document.getElementById(&#39;s2&#39;).previousSibling.id);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>第二個例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&lt;span&gt;span 1&lt;&#x2F;span&gt;&lt;span&gt;span 2&lt;&#x2F;span&gt;&lt;span&gt;span 3&lt;&#x2F;span&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  var el &#x3D; document.querySelector(&#39;span&#39;);</span><br><span class="line">  console.log( el.previousSibling );    &#x2F;&#x2F; null</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; document.querySelectorAll 會取得所有符合條件的集合，</span><br><span class="line">  &#x2F;&#x2F; 而 document.querySelectorAll(&#39;span&#39;)[2] 指的是「第三個」符合條件的元素。</span><br><span class="line">  var el2 &#x3D; document.querySelectorAll(&#39;span&#39;)[2];</span><br><span class="line">  console.log( el2.previousSibling.textContent );    &#x2F;&#x2F; &quot;span 2&quot;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Node-nextSibling"><a href="#Node-nextSibling" class="headerlink" title="Node.nextSibling"></a>Node.nextSibling</h3><p>透過 <code>Node.previousSibling</code> 可以取得同層之間的「下一個」節點，如果 node 已經是最後一個節點，則回傳 <code>null</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;&lt;span id&#x3D;&quot;s1&quot;&gt;s1&lt;&#x2F;span&gt;&lt;span id&#x3D;&quot;s2&quot;&gt;s2&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    &#x2F;&#x2F; 會顯示 &quot;s2&quot;</span><br><span class="line">    alert(document.getElementById(&#39;s1&#39;).nextSibling.id);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 會顯示 null</span><br><span class="line">    alert(document.getElementById(&#39;s2&#39;).nextSibling);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>第二個例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&lt;span&gt;span 1&lt;&#x2F;span&gt;&lt;span&gt;span 2&lt;&#x2F;span&gt;&lt;span&gt;span 3&lt;&#x2F;span&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    &#x2F;&#x2F; document.querySelector 會取得第一個符合條件的元素</span><br><span class="line">    var el &#x3D; document.querySelector(&#39;span&#39;);</span><br><span class="line"></span><br><span class="line">    console.log( el.nextSibling.textContent );    &#x2F;&#x2F; &quot;span 2&quot;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>上面介紹的很多 DOM 查找方式會返回一個元素集合，是一個像陣列的物件 - 有 length 屬性、可以用 for 迴圈遍歷結果，雖然不能使用陣列型別的 method，但這兩種都可以用「陣列索引」的方式來存取內容。</p>
<p>而 NodeList 和 HTMLCollection 的差別在於，<strong>NodeList 包含任何的節點類型，除了 HTML element 節點，也包含文字節點、屬性節點等。HTMLCollection 則只包含 HTML 元素節點 (Element nodes)</strong>。</p>
<p>像是 <code>document.getElementsBy**</code> (注意，有個 s) 以及 <code>document.querySelectorAll</code> 分別回傳 「HTMLCollection」 與 「NodeList」。</p>
<p>另一個需要注意的地方是，<code>HTMLCollection</code> / <code>NodeList</code> 在大部分情況下是<strong>即時更新</strong>的，但透過  <code>document.querySelectorAll</code> 會回傳一個靜態的 <code>NodeList</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;outer&quot;&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;inner&quot;&gt;inner&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; &lt;div id&#x3D;&quot;outer&quot;&gt;</span><br><span class="line">  var outerDiv &#x3D; document.getElementById(&#39;outer&#39;);</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 所有的 &lt;div&gt; 標籤</span><br><span class="line">  var allDivs &#x3D; document.getElementsByTagName(&#39;div&#39;);</span><br><span class="line"></span><br><span class="line">  console.log(allDivs.length);    &#x2F;&#x2F; 2</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 清空 &lt;div id&#x3D;&quot;outer&quot;&gt; 下的節點</span><br><span class="line">  outerDiv.innerHTML &#x3D; &#39;&#39;;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 因為清空了&lt;div id&#x3D;&quot;outer&quot;&gt; 下的節點，所以只剩下 outer</span><br><span class="line">  console.log(allDivs.length);    &#x2F;&#x2F; 1</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>如果改成 <code>document.querySelector</code> 的寫法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;outer&quot;&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;inner&quot;&gt;inner&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; &lt;div id&#x3D;&quot;outer&quot;&gt;</span><br><span class="line">  var outerDiv &#x3D; document.getElementById(&#39;outer&#39;);</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 所有的 &lt;div&gt; 標籤</span><br><span class="line">  var allDivs &#x3D; document.querySelectorAll(&#39;div&#39;);</span><br><span class="line"></span><br><span class="line">  console.log(allDivs.length);    &#x2F;&#x2F; 2</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 清空 &lt;div id&#x3D;&quot;outer&quot;&gt; 下的節點</span><br><span class="line">  outerDiv.innerHTML &#x3D; &#39;&#39;;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; document.querySelector 回傳的是靜態的 NodeList，不受 outerDiv 更新影響</span><br><span class="line">  console.log(allDivs.length);    &#x2F;&#x2F; 2</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h3><ol>
<li><p><a href="https://ithelp.ithome.com.tw/articles/10191765" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10191765</a></p>
</li>
<li><p><a href="https://www.fooish.com/javascript/dom/" target="_blank" rel="noopener">https://www.fooish.com/javascript/dom/</a></p>
</li>
<li><p><a href="https://www.fooish.com/javascript/dom/traversing.html" target="_blank" rel="noopener">https://www.fooish.com/javascript/dom/traversing.html</a></p>
</li>
</ol>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/HTML/" rel="tag">HTML</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="../../">上一頁</a><a class="page-number" href="../../">1</a><span class="page-number current">2</span><a class="page-number" href="../3/">3</a><a class="page-number" href="../4/">4</a><a class="extend next" rel="next" href="../3/">下一頁</a>
  </nav>

</section>
          <aside id="sidebar">
  
    <div style="margin: 20px 0;">
	<div id="search-form-wrap">

    <form class="search-form">
        <label style="width: 72%;">
            <span class="screen-reader-text">Search for:</span>
            <input type="search" class="search-field" style="height: 36px; width: 100%;" placeholder=" 搜尋…" value="" name="s" title="Search for:">
        </label>
        <input type="submit" class="search-form-submit" value="搜尋">
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="請輸入關鍵詞..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '頁面',
            CATEGORIES: '分類',
            TAGS: '標籤',
            UNTITLED: '(無標題)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '../../content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="../../js/insight.js"></script>


</div>
</div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">聯絡資訊</h3>
    <div class="widget widget_athemes_social_icons">

    	<ul class="clearfix widget-social-icons">   
    	
   			<li><a href="https://github.com/Cheng-Yi-Ting" target="_blank" rel="noopener" title="Github"><i class="fa fa-github" aria-hidden="true"></i></a></li> 

   		
   			<li><a href="https://www.facebook.com/peterchengapple?ref=bookmarks" target="_blank" rel="noopener" title="Facebook"><i class="fa fa-facebook" aria-hidden="true"></i></a></li> 

   		
   		</ul>


   		<!--
   		<ul class="clearfix widget-social-icons">   		
   		<li class="widget-si-twitter"><a href="http://twitter.com" target="_blank" rel="noopener" title="Twitter"><i class="ico-twitter"></i></a></li> 
		<li class="widget-si-facebook"><a href="http://facebook.com" target="_blank" rel="noopener" title="Facebook"><i class="ico-facebook"></i></a></li>
			<li class="widget-si-gplus"><a href="http://plus.google.com" target="_blank" rel="noopener" title="Google+"><i class="ico-gplus"></i></a></li>
			<li class="widget-si-pinterest"><a href="http://pinterest.com" target="_blank" rel="noopener" title="Pinterest"><i class="ico-pinterest"></i></a></li>
			<li class="widget-si-flickr"><a href="http://flickr.com" target="_blank" rel="noopener" title="Flickr"><i class="ico-flickr"></i></a></li>
			<li class="widget-si-instagram"><a href="http://instagram.com" target="_blank" rel="noopener" title="Instagram"><i class="ico-instagram"></i></a></li>
		</ul> -->

    </div>
  </div>


  
    
  <div class="widget_athemes_tabs">
    <ul id="widget-tab" class="clearfix widget-tab-nav">
      <li class="active"><a>最新文章</a></li>
    </ul>
    <div class="widget">
      <ul>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="../../2020/02/08/2020-02-08-HexoBackup/">Hexo 備份</a></h6>
              <span>二月 8, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="../../2020/02/08/2020-02-08-MarkText/">Markdown editor - MarkText</a></h6>
              <span>二月 8, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="../../2020/02/02/2020-02-01-JavaScript-28/">JavaScript - 音樂播放器</a></h6>
              <span>二月 2, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="../../2020/02/01/2020-01-28-JavaScript-27/">Web Storage</a></h6>
              <span>二月 1, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="../../2020/01/23/2020-01-19-JavaScript-26/">JavaScript - Async/Await</a></h6>
              <span>一月 23, 2020</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="../../2020/01/18/2020-01-11-JavaScript-25/">JavaScript - Promise</a></h6>
              <span>一月 18, 2020</span>
            </div>

          </li>
        
      </ul>
    </div>
  </div>

  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Audio/" rel="tag">Audio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/CSS/" rel="tag">CSS</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/ES6/" rel="tag">ES6</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/ES7/" rel="tag">ES7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Editor/" rel="tag">Editor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Event-Delegation/" rel="tag">Event Delegation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Git/" rel="tag">Git</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/GitHub/" rel="tag">GitHub</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/HTML/" rel="tag">HTML</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/HTML5/" rel="tag">HTML5</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/IDE/" rel="tag">IDE</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/JavaScript/" rel="tag">JavaScript</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Markdown/" rel="tag">Markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/VSCode/" rel="tag">VSCode</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/%E9%9D%9E%E6%8A%80%E8%A1%93/" rel="tag">非技術</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤雲</h3>
    <div class="widget tagcloud">
      <a href="../../tags/Audio/" style="font-size: 10px;">Audio</a> <a href="../../tags/CSS/" style="font-size: 12.5px;">CSS</a> <a href="../../tags/ES6/" style="font-size: 12.5px;">ES6</a> <a href="../../tags/ES7/" style="font-size: 10px;">ES7</a> <a href="../../tags/Editor/" style="font-size: 10px;">Editor</a> <a href="../../tags/Event-Delegation/" style="font-size: 10px;">Event Delegation</a> <a href="../../tags/Git/" style="font-size: 15px;">Git</a> <a href="../../tags/GitHub/" style="font-size: 10px;">GitHub</a> <a href="../../tags/HTML/" style="font-size: 17.5px;">HTML</a> <a href="../../tags/HTML5/" style="font-size: 12.5px;">HTML5</a> <a href="../../tags/Hexo/" style="font-size: 12.5px;">Hexo</a> <a href="../../tags/IDE/" style="font-size: 12.5px;">IDE</a> <a href="../../tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="../../tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="../../tags/VSCode/" style="font-size: 12.5px;">VSCode</a> <a href="../../tags/%E9%9D%9E%E6%8A%80%E8%A1%93/" style="font-size: 10px;">非技術</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">歸檔</h3>

    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/02/">二月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2020/01/">一月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2019/12/">十二月 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2019/11/">十一月 2019</a><span class="archive-list-count">25</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../archives" class="mobile-nav-link">Archives</a>
  
    <a href="../../categories" class="mobile-nav-link">Categories</a>
  
    <a href="../../tags" class="mobile-nav-link">Tags</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
    

                <div class="clearfix container">
                    <div class="site-info">
                        &copy;
                        2020
                            Cyting 部落格 All Rights Reserved.
                                

                                    
                    </div>
                    <div class="site-credit">
                        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
                    </div>
                </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
</script>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  
<link rel="stylesheet" href="../../fancybox/jquery.fancybox.css">

  
<script src="../../fancybox/jquery.fancybox.pack.js"></script>




<script src="../../js/script.js"></script>


<script src="../../js/bootstrap.js"></script>


<script src="../../js/main.js"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '[object Object]', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->






  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
